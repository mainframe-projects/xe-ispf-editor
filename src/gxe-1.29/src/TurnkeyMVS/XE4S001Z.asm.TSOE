XE4S001Z TITLE '*** XE4S001Z *** DISPLAY/UPDATE SPF INFO ***'           00010002
*********************************************************************** 00020002
*#011 080626 TSO/E:DISPLAY/CHANGE SECONDS                               00020123
*#010 080626 TSO/E:SET CRE-DATE=CHG-DATE IF CDATE=0 TO DISPLAY OF SPF   00020222
*#009 080626 TSO/E:RSV FLD AFTER VVMM MAY BE SECONDS OF MOD-TIME        00020321
*#008 080626 TSO/E:RSV FLD AFTER USERNAME OF DIR ENTRY IS SPACE         00020420
*#007 080626 LIST DISPLAY COLUMN ADJUST                                 00020519
*#006 080625 SPF D/S IS NOT ONLY FOR FIXED LRECL 80                     00020618
*#005 080625 ISSUE ERRMSG WHEN STOW FAILED                              00020718
*#004 080605 ABEND 0C1 IF PARM MISSING                                  00021014
*#004 080602 ASSMBLY ERR                                                00022014
*#003 061201 SPF UPDATE FOR ALL PDS MEMBER                              00030002
*#002 061125 UPDATE SPF INFO                                            00040002
*#001 061125 USE BLDL WHEN MEMBER SPECIFIED                             00050002
********************************************************************    00060002
*ASSEMBLE MACLIB ***************************************************    00070002
*//SYSLIB   DD   DSN=SYS2.MACLIB,DISP=SHR                               00080002
*//         DD   DSN=SYS1.MACLIB,DISP=SHR                               00090002
*//         DD   DSN=SYS1.AMODGEN,DISP=SHR                              00100002
*                                                                       00110002
*(1)* DISPLAY SPF INFORMATION ON PDS DIRECTORY *********************    00120002
*                                                                       00130002
*SAMPLE JCL TO EXECUTE BATCH *                                          00140002
*//GO EXEC PGM=XE4S001Z,PARM='HERC01.SOURCE.ASM'                        00150002
*//STEPLIB DD DISP=SHR,DSN=HERC01.LOAD.ASM                              00160002
*//GO EXEC PGM=XE4S001Z,PARM='HERC01.SOURCE.ASM(MEMB)'                  00170002
*//STEPLIB DD DISP=SHR,DSN=HERC01.LOAD.ASM                              00180002
*                                                                       00190002
*CALL ON TSO *                                                          00200002
* CALL 'HERC01.LOAD.ASM(XE4S001Z)' 'HERC01.SOURCE.ASM'                  00210002
* CALL 'HERC01.LOAD.ASM(XE4S001Z)' 'HERC01.SOURCE.ASM(MEMB)'            00220002
*                                                                       00230002
*OUTPUT SAMPLE *                                                        00240002
*MEMBER LIST FOR HERC01.TEST1.SRC                                       00250002
*-DSORG=PO RECFM=FB LRECL=00080 BLKSIZE=03120                           00260002
*-NAME---  VV.MM  CREATED   LAST-UPDATED     LINE-COUNT  INITIAL USER   00270002
*@         80.00  06/11/20  06/11/20 15:27:30         1        1 HERC03 00280023
*@@2       -                                                            00290002
*AAAAHH    80.00  06/11/15  06/11/15 11:39:32        12       12 HERC03 00300023
*-END OF LIST- 000075 MEMBER (000000 ALIAS)                             00310002
*                                                                       00320002
*(2)* UPDATE  SPF INFORMATION ON PDS DIRECTORY *********************    00330002
* PARM FORMAT                                                           00340002
*  '1,DSN(MEMB),VV,MM,CDATE,UDATE,UTIME,CURLINE,INITLINE,USER'          00350002
*                                                                       00360002
*  (START BY NOT NUMERIC MEANS MISSING OPERAND EXCEPT FOR USERID)       00370002
*  (!!! RPF(V153) NEED CRE-DATE/UP-DATE/USERID TO DISPLY ON DIRLIST)    00380002
*  MEMB:WILDCARD(*/?) ALLOWED                                           00390002
*  1:FUNCTION ID:UPDATE SPF INFO                                        00400002
*  VV:VERSION                                                           00410002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0 IF NO PREVIOUS INFO        00420002
*     +N FORMAT IS USED TO INCREMENT                                    00430002
*  MM:MODIFICATION LEVEL                                                00440002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0 IF NO PREVIOUS INFO        00450002
*     +N FORMAT IS USED TO INCREMENT                                    00460002
*     'NOW' IS USED TO SET TO MAX VALUE OF COLUMN 79-80                 00470002
*  CDATE:CREATED DATE                                                   00480002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0     IF NO PREVIOUS INFO    00490002
*     'NOW' IS USED TO SET TO TODAY                                     00500002
*     '000000' IS USED TO SET TO 0                                      00510002
*  UDATE:LAST UPDATED DATE                                              00520002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0     IF NO PREVIOUS INFO    00530002
*     'NOW' IS USED TO SET TO TODAY                                     00540002
*     '000000' IS USED TO SET TO 0                                      00550002
*  UTIME:LAST UPDATED TIME                                              00560002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0       IF NO PREVIOUS INFO  00570002
*     'NOW' IS USED TO SET TO CURRENT TIME                              00580002
*  CURLINE:CURRENT LINE COUNT                                           00590002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0 IF NO PREVIOUS INFO        00600002
*     'NOW' IS USED TO SET CURRENT LINE COUNT BY READING MEMBER         00610002
*  INITLINE:INITIAL LINE COUNT                                          00620002
*     IF MISSING,KEEP CURRENT VALUE OR SET 0 IF NO PREVIOUS INFO.       00630002
*     'NOW' IS USED TO SET CURRENT LINE COUNT BY READING MEMBER         00640002
*  USER   :LAST UPDATED USER                                            00650002
*     IF MISSING,KEEP CURRENT VALUE OR SET BLANK IF NO PREVIOUS INFO    00660002
*SAMPLE JCL TO EXECUTE BATCH *                                          00670002
*//GO EXEC PGM=XE4S001Z,PARM=('1','HERC01.SOURCE.ASM(MEMB),',           00680002
*//        '01,21,061105,061125,2210,99,101,HERC01')                    00690002
*//GO EXEC PGM=XE4S001Z,PARM=('1','HERC01.SOURCE.ASM(MEMB),',           00700002
*//        'VV,+1,CDT,NOW,NOW,CLC,NOW,HERC01')                          00710002
*//GO EXEC PGM=XE4S001Z,PARM='1,HERC01.SOURCE.ASM(MEMB),DEL'            00720002
*//STEPLIB DD DISP=SHR,DSN=HERC01.LOAD.ASM                              00730002
********************************************************************    00740002
*GET SPF INFO                                               A#####      00750002
*            DIRECTORY ENTRY FORMAT(SIZE=X'20')                         00760002
*              +00   MEMBER NAME                                        00770002
*              +08   TTR                                                00780002
*              +0B   FLAG                                               00790002
*              +0C   VERSION                                            00800002
*              +0D   MODIFIER LEVEL                                     00810002
*              +0E   ??                                                 00820002
*              +10   CREATED DATE 00YYDDD                               00830002
*              +14   LAST CHANGED DATE 00YYDDD                          00840002
*              +18   LAST CHANGED TIME HHMM                             00850002
*              +1A   CURRENT LINE SIZE                                  00860002
*              +1C   INIT    LINE SIZE                                  00870002
*              +1E   UPDATED LINE SIZE                                  00880002
*********************************************************************** 00890002
         MACRO                                                          00900002
&NAME    DOEXIT &P1,&P2,&P3,&P4,&P5,&P6,&P7,&P8,&P9,&P10,&P11,&P12,    *00910002
               &P13,&P14,&P15,&P16,&P17,&P18,&P19,&P20,&C=              00920002
&NAME    IF    &P1,&P2,&P3,&P4,&P5,&P6,&P7,&P8,&P9,&P10,&P11,&P12,&P13,*00930002
               &P14,&P15,&P16,&P17,&P18,&P19,&P20,C=&C                  00940002
           EXIT                                                         00950002
         ENDIF                                                          00960002
         MEND                                                           00970002
 COPY UCFUNCMM                                                          00972009
 COPY UCFUNCSP                                                          00973009
.*====================================================================* 00980002
         MACRO                                                          00990002
&LBL     SRST   &R1,&R2          END ADDR REG, START ADDR REG           01000002
.*       CC=1 IF CHAR OF R0(LAT BYTE) IS FOUND &R1 IS SET TO THE ADDR   01010002
.*       CC=2 IF NOT FOUND,REG UNCHANGED                                01020002
.*       CC=3 256 BYTE SERACHED &R2 CHANGED TO PINT THE NEXT 256 BYTE   01030002
         XR     R0,&R1                                                  01040002
         XR     &R1,R0                                                  01050002
         XR     R0,&R1              EXCHANGE R0 AND &R1                 01060002
#&SYSNDX.N  EQU *                                                       01070002
         EX     &R1,#&SYSNDX.EX                                         01080002
         BE     #&SYSNDX.F          FOUND                               01090002
         LA     &R2,1(&R2)                                              01100002
         CR     &R2,R0                                                  01110002
         BH     #&SYSNDX.NF         NOT FOUND                           01120002
         B      #&SYSNDX.N          CONTINUE SEARCH                     01130002
#&SYSNDX.F  EQU *        FOUND                                          01140002
         XR     R0,&R1                                                  01150002
         XR     &R1,R0                                                  01160002
         XR     R0,&R1              EXCHANGE R0 AND &R1                 01170002
         LR     &R1,&R2                                                 01180002
         OR     &R1,&R1             SET CC=1(NON ZERO)                  01190002
         B #&SYSNDX.X                                                   01200002
#&SYSNDX.NF EQU *        NOT FOUND                                      01210002
         XR     R0,&R1                                                  01220002
         XR     &R1,R0                                                  01230002
         XR     R0,&R1              EXCHANGE R0 AND &R1                 01240002
         CR     &R2,&R1             &R2>&R1 CC=2(HIGH)                  01250002
         B #&SYSNDX.X                                                   01260002
#&SYSNDX.EX CLI 0(&R2),0                                                01270002
#&SYSNDX.X  EQU *                                                       01280002
         MEND                                                           01290002
.*====================================================================* 01300002
         MACRO                                                          01310002
         GBLSET               ,        *INT MAX 1S 10 BYTE              01320002
.*                                                                      01330002
    GBLC &UCFSR14                                                       01340002
    GBLC &UCFSR15                                                       01350002
    GBLC &UCFSR0                                                        01360002
    GBLC &UCFSR1                                                        01370002
    GBLC &UCFOPD1                                                       01380002
    GBLC &UCFOPD2                                                       01390002
    GBLC &UCFOPD3                                                       01400002
    GBLC &UCFOPD4                                                       01410002
    GBLC &UCFWRK1                                                       01420002
    GBLC &UCFWRK2                                                       01430002
    GBLC &UCFWRK3                                                       01440002
    GBLC &UCFWRK4                                                       01450002
    GBLC &UCFWRK5                                                       01460002
    GBLC &UCFWRK6                                                       01470002
    GBLC &UCFWRK7                                                       01480002
&UCFSR14 SETC  '12(R13)'      R14                                       01490002
&UCFSR15 SETC  '16(R13)'      R15                                       01500002
&UCFSR0  SETC  '20(R13)'       R0                                       01510002
&UCFSR1  SETC  '24(R13)'       R1                                       01520002
&UCFOPD1 SETC  '28(R13)'      OPEARND SAVE 1                            01530002
&UCFOPD2 SETC  '32(R13)'      OPEARND SAVE 2                            01540002
&UCFOPD3 SETC  '36(R13)'      OPEARND SAVE 3                            01550002
&UCFOPD4 SETC  '40(R13)'      OPEARND SAVE 4                            01560002
&UCFWRK1 SETC  '44(R13)'      WORK1                                     01570002
&UCFWRK2 SETC  '48(R13)'      WORK2                                     01580002
&UCFWRK3 SETC  '52(R13)'      WORK3                                     01590002
&UCFWRK4 SETC  '56(R13)'      WORK4                                     01600002
&UCFWRK5 SETC  '60(R13)'      WORK5                                     01610002
&UCFWRK6 SETC  '64(R13)'      WORK6                                     01620002
&UCFWRK7 SETC  '68(R13)'      WORK7                                     01630002
         MEND  GBLSET                                                   01640002
.*====================================================================* 01650002
.* MACRO NAME : UATOI  _ (GET NUMERIC VALUE)                          * 01660002
.* FORMAT     : LBL UATOI INPA,ENDCHAR=X'00',LEN=                       01670002
.*          (1) INPA   :IINPUT AREA                                     01680002
.*          (2) ENDCHAR:TERMINATION CHAR FOR PARM STRING              * 01690002
.*          (3) LEN    :OPTIONAL MAX LEN PARM                         * 01700002
.* I/O CONDITION                                                        01710002
.*  WORK REG R1,R14,R15   DESTROIED                                     01720002
.*  EXIT CONDITION                                                    * 01730002
.*           R1:BINARY VALUE                                            01740002
.* EXAMPLE                                                            * 01750002
.*     UATOI    INPA                                                    01760002
.*     UATOI    (R2),ENDCHAR=C' '                      *                01770002
.*     UATOI    (R2),LEN=(R0)                          *                01780002
.*====================================================================* 01790002
         MACRO                                                          01800002
&LBL     UATOI  &IN,&ENDCHAR=X'00',&LEN=                                01810002
.********************************************************************** 01820002
&LBL     DS  0H                                                         01830002
.*********                                                              01840002
    GBLC &UCFSR14                                                       01850002
    GBLC &UCFSR15                                                       01860002
    GBLC &UCFSR0                                                        01870002
    GBLC &UCFSR1                                                        01880002
    GBLC &UCFOPD1                                                       01890002
    GBLC &UCFOPD2                                                       01900002
    GBLC &UCFOPD3                                                       01910002
    GBLC &UCFOPD4                                                       01920002
    GBLC &UCFWRK1                                                       01930002
    GBLC &UCFWRK2                                                       01940002
    GBLC &UCFWRK3                                                       01950002
    GBLC &UCFWRK4                                                       01960002
    GBLC &UCFWRK5                                                       01970002
    GBLC &UCFWRK6                                                       01980002
    GBLC &UCFWRK7                                                       01990002
.*********                                                              02000002
&LBL     DS 0H                                                          02010002
         STM R14,R0,&UCFSR14                                            02020002
.*IN   ***                                                              02030002
         AIF ('&IN'(1,1) EQ '(').RIN                                    02040002
         LA R0,&IN                     GET INT VALUE                    02050002
         AGO .COM1                                                      02060002
.RIN     ANOP                                                           02070002
         AIF ('&IN(1)' EQ 'R0').COM1                                    02080002
         LR R0,&IN(1)                 GET INT VALUE                     02090002
.COM1    ANOP                                                           02100002
.*OUT  ***                                                              02110002
         AIF ('&LEN' EQ '').NOLEN                                       02120002
         AIF ('&LEN'(1,1) EQ '(').RLEN                                  02130002
         LA R14,&LEN                  IMMEDIATE VALUE                   02140002
         AGO .COM2                                                      02150002
.RLEN    ANOP                                                           02160002
         AIF ('&LEN(1)' EQ 'R0').REST                                   02170002
         LR R14,&LEN(1)                 GET INT VALUE                   02180002
         AGO .COM2                                                      02190002
.REST    ANOP                                                           02200002
         L R14,&UCFSR0                 ORIGINAL R0 FOR OUT ADDR         02210002
         AGO .COM2                                                      02220002
.NOLEN   ANOP                                                           02230002
         SR R14,R14                   INFINITE                          02240002
         BCTR R14,0                                                     02250002
.COM2    ANOP                                                           02260002
.*PROCESS*                                                              02270002
         SR R1,R1                                                       02280002
         LR R15,R0                    ADDR                              02290002
         SR R0,R0                                                       02300002
         DO FROM=(R14)                                                  02310002
         DOEXIT (CLI,0(R15),E,&ENDCHAR)                                 02320002
         DOEXIT (CLI,0(R15),LT,C'0')                                    02330002
         DOEXIT (CLI,0(R15),GT,C'9')                                    02340002
           IC R0,0(R15)                                                 02350002
           SLL R0,24+4                                                  02360002
           SRL R0,24+4                                                  02370002
           MH R1,=Y(10)                                                 02380002
           AR R1,R0                                                     02390002
           LA R15,1(R15)                                                02400002
         ENDDO                                                          02410002
.*                                                                      02420002
.********                                                               02430002
         LM  R14,R0,&UCFSR14                                            02440002
         MEND     UATOI                                                 02450002
.*====================================================================* 02460002
.* MACRO NAME : UI2Z    CONV INT TO 10 ZONE DIGIT                       02470002
.* FORMAT     : LBL UI2Z &IN,&OUT,&LEN=                                 02480002
.*          (1) IN     :INT TYPE  ADDR OR (RX) VALUE      *             02490002
.*          (2) OUT    :OUT AREA ADDR(LAST BYTE CONTAIN SIGN)           02500002
.*                      ADDR OR (RX) FORMAT                             02510002
.*                      IF OMMITTED R1 POINT ZONE ADDR ON SAVE AREA     02520002
.*          (3) LEN    :OUT AREA LEN   EQU ONLY                         02530002
.* I/O CONDITION                                                        02540002
.*  ALL REG PRESERVED                                                   02550002
.*    EXCEPT R1:ADDR OF ZONE IF OUT PARM NOT SPECIFIED                  02560002
.*  EXIT CONDITION                                                    * 02570002
.*     NONE                                                             02580002
.* EXAMPLE                                                            * 02590002
.*     UI2Z     (R1),OUTA                                               02600002
.*     UI2Z     INPA,(R3),LEN=8                                         02610002
.*     UI2Z     INPA                                                    02620002
.*====================================================================* 02630002
         MACRO                                                          02640002
&LBL     UI2Z &IN,&OUT,&LEN=           *INT MAX 1S 10 BYTE              02650002
.*********                                                              02660002
    GBLC &UCFSR14                                                       02670002
    GBLC &UCFSR15                                                       02680002
    GBLC &UCFSR0                                                        02690002
    GBLC &UCFSR1                                                        02700002
    GBLC &UCFOPD1                                                       02710002
    GBLC &UCFOPD2                                                       02720002
    GBLC &UCFOPD3                                                       02730002
    GBLC &UCFOPD4                                                       02740002
    GBLC &UCFWRK1                                                       02750002
    GBLC &UCFWRK2                                                       02760002
    GBLC &UCFWRK3                                                       02770002
    GBLC &UCFWRK4                                                       02780002
    GBLC &UCFWRK5                                                       02790002
    GBLC &UCFWRK6                                                       02800002
    GBLC &UCFWRK7                                                       02810002
.*********                                                              02820002
         AIF ('&LEN' NE '').LENOK                                       02830002
         MNOTE 8,'UI2Z-01:LEN= PARM(OUTPUT AREA LEN) IS MISSING'        02840002
         MEXIT                                                          02850002
.LENOK   ANOP                                                           02860002
&LBL     DS 0H                                                          02870002
         STM R14,R0,&UCFSR14                                            02880002
.*IN   ***                                                              02890002
         AIF ('&IN'(1,1) EQ '(').RIN                                    02900002
         ICM R0,B'1111',&IN                     GET INT VALUE           02910002
         AGO .COM1                                                      02920002
.RIN     ANOP                                                           02930002
         AIF ('&IN(1)' EQ 'R0').COM1                                    02940002
         LR R0,&IN(1)                 GET INT VALUE                     02950002
.COM1    ANOP                                                           02960002
.*OUT  ***                                                              02970002
         AIF ('&OUT' EQ '').NOOUT1                                      02980002
         AIF ('&OUT'(1,1) EQ '(').ROUT                                  02990002
         LA R14,&OUT                    GET OUT ADDR VALUE              03000002
         AGO .COM2                                                      03010002
.ROUT    ANOP                                                           03020002
         AIF ('&OUT(1)' EQ 'R0').REST                                   03030002
         LR R14,&OUT(1)                 GET INT VALUE                   03040002
         AGO .COM2                                                      03050002
.REST    ANOP                                                           03060002
         L R14,&UCFSR0                 ORIGINAL R0 FOR OUT ADDR         03070002
.COM2    ANOP                                                           03080002
         AGO .COM3                                                      03090002
.NOOUT1  ANOP                                                           03100002
         LA R14,&UCFWRK3               ZONE WORK                        03110002
.COM3    ANOP                                                           03120002
.*PROCESS*                                                              03130002
         LA R15,&UCFWRK1              PACK WORK                         03140002
         CVD R0,0(R15)                                                  03150002
.*                                                                      03160002
         UNPK 0(&LEN,R14),0(8,R15)       VALUE                          03170002
         LTR R0,R0                                                      03180002
.*       BM UI2Z_&SYSNDX.2                                   D#@@@@2    03190002
         BM #&SYSNDX.#2                                      A#@@@@2    03200002
.*                                                                      03210002
         OI &LEN-1(R14),X'F0'                                           03220002
.*                                                                      03230002
.*UI2Z_&SYSNDX.2 EQU *                                        D#@@@@2   03240002
#&SYSNDX.#2 EQU *                                             A#@@@@2   03250002
.********                                                               03260002
         LM  R14,R0,&UCFSR14                                            03270002
         MEND  UI2Z                                                     03280002
.*====================================================================* 03290002
.*ULN#00000 980511 P01040 CREATED                                     * 03300002
.*====================================================================* 03310002
.* MACRO NAME : UI2ZE   STANDARD INTEGER EDIT (-Z,ZZZ,ZZZ,ZZ9)          03320002
.*                      FOR MINUS '-' IS SET AT BEFORE FIRST DIGIT      03330002
.* FORMAT     : LBL UI2ZE &IN,&OUT,&LEN=14                              03340002
.*          (1) IN     :INT TYPE  ADDR OR (RX) VALUE      *             03350002
.*          (2) OUT    :OUT AREA ADDR(LAST BYTE CONTAIN SIGN)           03360002
.*                      ADDR OR (RX) FORMAT                             03370002
.*                      IF OMMITTED R1 POINT AREA ON SAVE AREA          03380002
.*                      OF LENGTH SPECIFIED BY &LEN                     03390002
.*          (3) LEN    :OUT AREA LEN   EQU ONLY (MAX IS 14)             03400002
.*                      COPY LAST N BYTE  TO OUT AREA                   03410002
.* I/O CONDITION                                                        03420002
.*  ALL REG PRESERVED                                                   03430002
.*    EXCEPT R1:ADDR OF ZONE IF OUT PARM NOT SPECIFIED                  03440002
.*  EXIT CONDITION                                                    * 03450002
.*     NONE                                                             03460002
.* EXAMPLE                                                            * 03470002
.*     UI2Z     (R1),OUTA                                               03480002
.*     UI2Z     INPA,(R3),LEN=8                                         03490002
.*     UI2Z     INPA                                                    03500002
.*====================================================================* 03510002
         MACRO                                                          03520002
&LBL     UI2ZE &IN,&OUT,&LEN=14                                         03530002
.*********                                                              03540002
    GBLC &UCFSR14                                                       03550002
    GBLC &UCFSR15                                                       03560002
    GBLC &UCFSR0                                                        03570002
    GBLC &UCFSR1                                                        03580002
    GBLC &UCFOPD1                                                       03590002
    GBLC &UCFOPD2                                                       03600002
    GBLC &UCFOPD3                                                       03610002
    GBLC &UCFOPD4                                                       03620002
    GBLC &UCFWRK1                                                       03630002
    GBLC &UCFWRK2                                                       03640002
    GBLC &UCFWRK3                                                       03650002
    GBLC &UCFWRK4                                                       03660002
    GBLC &UCFWRK5                                                       03670002
    GBLC &UCFWRK6                                                       03680002
    GBLC &UCFWRK7                                                       03690002
         LCLC &MAXLEN,&CPYLEN                                   A#@@@@2 03700002
.*********                                                              03710002
&MAXLEN  SETC '15'                    OUTPUT MAX LEN                    03720002
&CPYLEN  SETC '&LEN'                     OUTPUT LEN                     03730002
.*********                                                              03740002
&LBL     DS 0H                                                          03750002
         STM R14,R1,&UCFSR14                                            03760002
.*IN   ***                                                              03770002
         AIF ('&IN'(1,1) EQ '(').RIN                                    03780002
         L R0,&IN                     GET INT VALUE                     03790002
         AGO .COM1                                                      03800002
.RIN     ANOP                                                           03810002
         AIF ('&IN(1)' EQ 'R0').COM1                                    03820002
         LR R0,&IN(1)                 GET INT VALUE                     03830002
.COM1    ANOP                                                           03840002
.*OUT  ***                                                              03850002
         AIF ('&OUT' EQ '').NOOUT1                                      03860002
         AIF ('&OUT'(1,1) EQ '(').ROUT                                  03870002
         LA R14,&OUT                    GET OUT ADDR VALUE              03880002
         AGO .COM2                                                      03890002
.ROUT    ANOP                                                           03900002
         AIF ('&OUT(1)' EQ 'R0').REST                                   03910002
         LR R14,&OUT(1)                 GET INT VALUE                   03920002
         AGO .COM2                                                      03930002
.REST    ANOP                                                           03940002
         L R14,&UCFSR0                 ORIGINAL R0 FOR OUT ADDR         03950002
.COM2    ANOP                                                           03960002
.NOOUT1  ANOP                                                           03970002
.*PROCESS*                                                              03980002
         LA R15,&UCFWRK1              PACK WORK,WRK1 AND WRK2           03990002
         CVD R0,0(R15)                                                  04000002
.*SET EDIT PATERN TO WRK3-WRK7(5*4=20 BYTE)                             04010002
.*SIGNIFICANT STARTER X'21' SHOULD NOT BE SET FOR EDMK SET R1           04020002
.*R1 SET WHEN DIGIT SELECTED AT THE STATUS SIGNIFICANT INDICATER OFF    04030002
         LA R15,&UCFWRK3              PACK WORK,WRK1 AND WRK2           04040002
         MVC 0(&MAXLEN,R15),=X'4020206B2020206B2020206B202020'          04050002
         EDMK 0(&MAXLEN,R15),2+&UCFWRK1  11 DIGIT=PL6=15BYTE OUT        04060002
.*       BP  UI2ZE_&SYSNDX.1        LAST FIELD >0               D#@@@@2 04070002
         BP  #&SYSNDX.#1            LAST FIELD >0               A#@@@@2 04080002
.*       BM  UI2ZE_&SYSNDX.M        LAST FIELD <0               D#@@@@2 04090002
         BM  #&SYSNDX.#M            LAST FIELD <0               A#@@@@2 04100002
         MVI &MAXLEN-1(R15),C'0'    FORCE ZERO                          04110002
.*       B   UI2ZE_&SYSNDX.1        LAST FIELD <0               D#@@@@2 04120002
         B   #&SYSNDX.#1       LAST FIELD <0                    A#@@@@2 04130002
.*UI2ZE_&SYSNDX.M EQU *                                         D#@@@@2 04140002
#&SYSNDX.#M EQU *                                               A#@@@@2 04150002
         BCTR R1,0                                                      04160002
         MVI 0(R1),C'-'                MINUS SIGN                       04170002
.*UI2ZE_&SYSNDX.1 EQU *                                         D#@@@@2 04180002
#&SYSNDX.#1 EQU *                                               A#@@@@2 04190002
         AIF ('&OUT' EQ '').NOOUT2                                      04200002
.*                                                                      04210002
         MVC 0(&CPYLEN,R14),&MAXLEN-&CPYLEN+&UCFWRK3                    04220002
.*                                                                      04230002
         AGO .COM3                                                      04240002
.NOOUT2  ANOP                                                           04250002
         LA R15,&MAXLEN-&CPYLEN.(R15) ON SAVE AREA                      04260002
         ST R15,&UCFSR1               RETURN R1                         04270002
.COM3    ANOP                                                           04280002
.********                                                               04290002
         LM  R14,R1,&UCFSR14                                            04300002
         MEND  UI2ZE                                                    04310002
.*====================================================================* 04320002
.*ULN#00000 980414 P01040 CREATED                                     * 04330002
.*====================================================================* 04340002
.* MACRO NAME : UI2X    CONV INT TO 8 HEX DIGIT                         04350002
.* FORMAT     : LBL UI2X &IN,&OUT,&LEN=                                 04360002
.*          (1) IN     :UINT TYPE  ADDR OR (RX) TYPE        *           04370002
.*                     :UINT  :WORD AS UNSIGNED             *           04380002
.*                     :SHORT :HALF WORD AS SIGNED          *           04390002
.*                     :USHORT:HALF WORD AS UNSIGNED          *         04400002
.*          (2) OUT    :OUT AREA ADDR                                   04410002
.*                      ADDR OR (RX) FORMAT                             04420002
.*                      IF OMMITTED R1 POINT HEX ADDR ON SAVE AREA      04430002
.*          (3) LEN    :LENGTH TO BE MOVED(LOWER BYTE)                  04440002
.*                      CONSTANT OR EQU FORMAT                          04450002
.*                      DEFAULT=8                                       04460002
.* I/O CONDITION                                                        04470002
.*  ALL REG PRESERVED EXCEP R1 FOR IF NO OUT AREA SPECIFIED             04480002
.*  EXIT CONDITION                                                    * 04490002
.*     NONE                                                             04500002
.* EXAMPLE                                                            * 04510002
.*     UI2X     (R1),OUTA                                               04520002
.*     UI2X     INPA,(R3)                                               04530002
.*     UI2X     (R0)                                                    04540002
.*====================================================================* 04550002
         MACRO                                                          04560002
&LBL     UI2X &IN,&OUT,&LEN=8                                           04570002
.*********                                                              04580002
    GBLC &UCFSR14                                                       04590002
    GBLC &UCFSR15                                                       04600002
    GBLC &UCFSR0                                                        04610002
    GBLC &UCFSR1                                                        04620002
    GBLC &UCFOPD1                                                       04630002
    GBLC &UCFOPD2                                                       04640002
    GBLC &UCFOPD3                                                       04650002
    GBLC &UCFOPD4                                                       04660002
    GBLC &UCFWRK1                                                       04670002
    GBLC &UCFWRK2                                                       04680002
    GBLC &UCFWRK3                                                       04690002
    GBLC &UCFWRK4                                                       04700002
    GBLC &UCFWRK5                                                       04710002
    GBLC &UCFWRK6                                                       04720002
    GBLC &UCFWRK7                                                       04730002
.*********                                                              04740002
.********************************************************************** 04750002
&LBL     DS 0H                                                          04760002
         STM R14,R0,&UCFSR14                                            04770002
.*IN   ***                                                              04780002
.*       UCFGOPD ADDRVAL,SAVE1,&IN   SAVE INP VALUE TO SAVE+28 D#0000   04790002
         ST &IN(1),&UCFOPD1          SAVE OPERAND TO SAVEAREA  A#0000   04800002
.*OUT  ***                                                              04810002
         AIF ('&OUT' EQ '').NOOUT1                                      04820002
.*       UCFGOPD ADDR,SAVE2,&OUT      GET ADDR VALUE TO SAVE+28 D#0000  04830002
         LA R0,&OUT                        GET OPD ADDR         A#0000  04840002
         ST R0,&UCFOPD2               SAVE OPERAND TO SAVEAREA  A#0000  04850002
.NOOUT1  ANOP                                                           04860002
.*PROCESS*                                                              04870002
         LA R15,&UCFOPD1               INP VALUE ADDR                   04880002
         LA R14,&UCFWRK1                UNPK AREA                       04890002
         UNPK 0(9,R14),0(5,R15)                                         04900002
.*       L R15,UI2X_&SYSNDX.V          INTF CSECT ADDR  D#0000  D#@@@@2 04910002
.*       L R15,#&SYSNDX.#V         INTF CSECT ADDR      D#0000  A#@@@@2 04920002
.*       L R15,&UCFPGMI(1)._TBLTOP(R15)      TBL HDR    D#0000          04930002
.*       L R15,(6-1)*4(R15)      ABLE TO CONV TO HEX DIGIT  D#0000      04940002
         L R15,#&SYSNDX.TRT             TR TABLE TO CONV TO HEX DIGIT   04950002
         TR 0(8,R14),0(R15)                                             04960002
.*                                                                      04970002
.*       B UI2X_&SYSNDX.X EQU *                               D#@@@@2   04980002
         B #&SYSNDX.#X EQU *                                  A#@@@@2   04990002
#&SYSNDX.TRT DC A(*+4-X'F0') TRANSLATE BIN TO HEX DIGIT A#0000          05000002
         DC C'0123456789ABCDEF' F0-->F9,FA-->FF TO C'0'-->C'F' A#0000   05010002
#&SYSNDX.#X EQU *                                               A#@@@@2 05020002
.*                                                                      05030002
         AIF ('&OUT' EQ '').NOOUT2                                      05040002
         L R15,&UCFOPD2                                                 05050002
         MVC 0(&LEN,R15),8-&LEN.(R14)                                   05060002
         AGO .COM3                                                      05070002
.NOOUT2  ANOP                                                           05080002
         LR R1,R14                     OUTPUT HEX DIGIT FIELD ADDR      05090002
.COM3    ANOP                                                           05100002
         LM  R14,R0,&UCFSR14                                            05110002
.*       UCFMEND                                                        05120002
         MEND   *UI2X                                                   05130002
.*+++++===============================================================* 05140002
.*====================================================================* 05150002
.* MACRO NAME : UMEMCHR                                               * 05160002
.*             (MEMCHR FUNCTION OF LANGUAGE C)                        * 05170002
.*              SEARCH A CHAR ON AREA OF SPECIFIED LENGTH             * 05180002
.* FORMAT     : LBL UMEMCHR ADDR,CHAR,LEN                             * 05190002
.*          (1) ADDR   :SEARCH AREA ADDR;   (RX) OR AREA-NAME         * 05200002
.*          (2) CHAR   :SEARCH CHAR;LITERAL/EQU OR (RX)               * 05210002
.*          (3) LEN    :SREARCH AREA LEN;  LITERAL/EQU OR (RX)        * 05220002
.* EXIT CONDITION                                                    *  05230002
.*    ALL REG IS PRESERVED EXCEPT R1                                    05240002
.*    R1          :FOUND ADDR,0 IF NOT FOUND                            05250002
.* EXAMPLE                                                            * 05260002
.*     UMEMCHR WKAREA,C' ',256                                        * 05270002
.*     UMEMCHR (R3),SRCHCHAR,(R2)                                     * 05280002
.*     UMEMCHR STRING,X'0E',EQUASZ                                    * 05290002
.*====================================================================* 05300002
         MACRO                                                          05310002
&L       UMEMCHR  &ADDR,&CHAR,&LEN                                      05320002
.*********                                                              05330002
    GBLC &UCFSR14                                                       05340002
    GBLC &UCFSR15                                                       05350002
    GBLC &UCFSR0                                                        05360002
    GBLC &UCFSR1                                                        05370002
    GBLC &UCFOPD1                                                       05380002
    GBLC &UCFOPD2                                                       05390002
    GBLC &UCFOPD3                                                       05400002
    GBLC &UCFOPD4                                                       05410002
    GBLC &UCFWRK1                                                       05420002
    GBLC &UCFWRK2                                                       05430002
    GBLC &UCFWRK3                                                       05440002
    GBLC &UCFWRK4                                                       05450002
    GBLC &UCFWRK5                                                       05460002
    GBLC &UCFWRK6                                                       05470002
    GBLC &UCFWRK7                                                       05480002
.*********                                                              05490002
&L       DS 0H                                                          05500002
         STM R15,R0,&UCFSR15                                            05510002
.**ADDR***                                                              05520002
.*       UCFGOPD ADDR,SAVE1,&ADDR     GET ADDR VALUE                    05530002
         AIF ('&ADDR'(1,1) EQ '(').RADDR                                05540002
         LA R0,&ADDR                                                    05550002
         AGO .SVADDR                                                    05560002
.RADDR   ANOP                                                           05570002
         LR R0,&ADDR(1)                    GET OPD ADDR         A#0000  05580002
.SVADDR  ANOP                                                           05590002
         ST R0,&UCFOPD1               SAVE OPERAND TO SAVEAREA  A#0000  05600002
.**LEN****                                                              05610002
.*       UCFGOPD EQU,SAVE2,&LEN       GET LEN  VALUE                    05620002
         ST &LEN(1),&UCFOPD2          SAVE OPERAND TO SAVEAREA  A#0000  05630002
.**CHAR***                                                              05640002
.*       UCFGOPD EQU1,R0,&CHAR        GET CHAR VALUE TO R0              05650002
         LA R0,&CHAR                       GET OPD ADDR         A#0000  05660002
.*********                                                              05670002
         UMEMCHR# &UCFOPD1,(R0),&UCFOPD2      SEARCH     R#@@@@2        05680002
.*                                                                      05690002
         LM  R15,R0,&UCFSR15                                            05700002
.*       UCFMEND                                                        05710002
         MEND  * MEMCHAR                                                05720002
.*====================================================================* 05730002
.* MACRO NAME : UMEMCHR_                                              * 05740002
.*              SUB OF UMEMCHR                                        * 05750002
.*              SEARCH A CHAR ON AREA OF SPECIFIED LENGTH             * 05760002
.* FORMAT     :     UMEMCHR ADDR,CHAR,LEN                               05770002
.*          (1) ADDR   :SEARCH AREA ADDR;   AREA-NAME                   05780002
.*          (2) CHAR   :SREARCH CHAR    ;   AREA-NAME ,(RX)           * 05790002
.*          (3) LEN    :SREARCH AREA LEN;   AREA-NAME ,(RX)           * 05800002
.* EXIT CONDITION                                                    *  05810002
.*    R15 :WORK REG                                                     05820002
.*    R1  :FOUND ADDR,0 IF NOT FOUND                                    05830002
.* EXAMPLE                                                            * 05840002
.*     UMEMCHR_  &UCFOPD1,(R0),&UCFOPD2                                 05850002
.*     UMEMCHR_  &UCFOPD1,&UCFOPD2,(R1)                                 05860002
.*====================================================================* 05870002
         MACRO                                                          05880002
         UMEMCHR# &ADDR,&CHAR,&LEN                    R#@@@@2           05890002
.*********                                                              05900002
    GBLC &UCFSR14                                                       05910002
    GBLC &UCFSR15                                                       05920002
    GBLC &UCFSR0                                                        05930002
    GBLC &UCFSR1                                                        05940002
    GBLC &UCFOPD1                                                       05950002
    GBLC &UCFOPD2                                                       05960002
    GBLC &UCFOPD3                                                       05970002
    GBLC &UCFOPD4                                                       05980002
    GBLC &UCFWRK1                                                       05990002
    GBLC &UCFWRK2                                                       06000002
    GBLC &UCFWRK3                                                       06010002
    GBLC &UCFWRK4                                                       06020002
    GBLC &UCFWRK5                                                       06030002
    GBLC &UCFWRK6                                                       06040002
    GBLC &UCFWRK7                                                       06050002
.*********                                                              06060002
.* UMEMCHR_ * START *                                                   06070002
.* CHAR                                                                 06080002
         AIF ('&CHAR'(1,1) NE '(').FLDC                                 06090002
         AIF ('&CHAR(1)' EQ 'R0').COMC                                  06100002
         LR R0,&CHAR(1)         SEARCH CHAR                             06110002
         AGO .COMC                                                      06120002
.FLDC    ANOP                                                           06130002
         L R0,&CHAR             SEARCH CHAR                             06140002
.COMC    ANOP                                                           06150002
.* ADDR                                                                 06160002
         AIF ('&ADDR'(1,1) NE '(').FLDA                                 06170002
         AIF ('&ADDR(1)' EQ 'R15').COMA                                 06180002
         AIF ('&ADDR(1)' NE 'R0').ADDROK                                06190002
         MNOTE 8,'UMEMCHR_-02:R0 IS NOT VALID FOR ADDR PARM'            06200002
         MEXIT                                                          06210002
.ADDROK  ANOP                                                           06220002
         LR R15,&ADDR(1)                                                06230002
         AGO .COMA                                                      06240002
.FLDA    ANOP                                                           06250002
         L R15,&ADDR             START ADDR                             06260002
.COMA    ANOP                                                           06270002
.*                                                                      06280002
         AIF ('&LEN'(1,1) EQ '(').REGLEN                                06290002
         L R1,&LEN               LEN                                    06300002
         AGO .SRCH                                                      06310002
.REGLEN  ANOP                                                           06320002
         AIF ('&LEN(1)' NE 'R15' AND '&LEN(1)' NE 'R0').REGOK           06330002
         MNOTE 8,'UMEMCHR_-01:R0/R15 IS NOT VALID FOR LEN PARM'         06340002
         MEXIT                                                          06350002
.REGOK   ANOP                                                           06360002
         AIF ('&LEN(1)' EQ 'R1').SRCH                                   06370002
         LR R1,&LEN                                                     06380002
.*                                                                      06390002
.SRCH    ANOP                                                           06400002
         AR R1,R15                    END ADDR                          06410002
.*UMEMCHR_&SYSNDX.7 EQU *                RETRY LOOP            D#@@@@2  06420002
#&SYSNDX.7 EQU *                         RETRY LOOP            A#@@@@2  06430002
         SRST R1,R15                     END ADDR,START ADDR            06440002
.*CC=1 FOUND;R1:FOUND ADDR,R2:NOT CHANGED                               06450002
.*       BC 4,UMEMCHR_&SYSNDX.5 CC=1,FOUND(R1:MATCH ADDR,R2:SAMED#@@@@2 06460002
         BC 4,#&SYSNDX.5 CC=1,FOUND(R1:MATCH ADDR,R2:SAME       A#@@@@2 06470002
.*CC=2 NOT FOUND;R1/R2 NOT CHANGED                                      06480002
.*       BC 2,UMEMCHR_&SYSNDX.6   CC=2,NOT FOUND(R1,R2:SAME)    D#@@@@2 06490002
         BC 2,#&SYSNDX.6          CC=2,NOT FOUND(R1,R2:SAME)    A#@@@@2 06500002
.*CC=3 SEARCHED 256;R2:CHANGED TO NEXT START ADDR,R1:NOT CHANGED        06510002
.*       B UMEMCHR_&SYSNDX.7 CC=3,RTRY BY NEW ADD(R1:SAME,R2:NEWD#@@@@2 06520002
         B #&SYSNDX.7 CC=3,RTRY BY NEW ADD(R1:SAME,R2:NEW)      A#@@@@2 06530002
.*UMEMCHR_&SYSNDX.6 EQU *               NOT FOUND              D#@@@@2  06540002
#&SYSNDX.6 EQU *                        NOT FOUND              A#@@@@2  06550002
         SR R1,R1                        NOT FOUND ID                   06560002
.*UMEMCHR_&SYSNDX.5 EQU *               FOUND                  D#@@@@2  06570002
#&SYSNDX.5 EQU *                        FOUND                  A#@@@@2  06580002
** UMEMCHR_ * END *                                                     06590002
         MEND   MEMCHR_                                                 06600002
.*====================================================================* 06610002
.*====================================================================* 06620002
.* MACRO NAME  = GET DATE ZONE(YYMMDD) SEIREKI                          06630002
.* FORMAT     : NAME UDATE AREA=,TODAY=,INPUT=,TBL=                     06640002
.* -OPERAND    - &NAME    : LABEL FOR MACRO START AND DATE TABLE        06650002
.*             - &AREA    : OUTPUT 6 BYTE FIELD                         06660002
.*             - &TODAY   : Y:CALC OF TODAY                             06670002
.*             -          : N:CALC OF &AREA FIELD(..YYDDD..... FMT)     06680002
.*             -          :   IF INPUT=J XL6'..YYDDD.....' FMT          06690002
.*             -          :   IF INPUT=S XL6'..YYMMDD....' FMT          06700002
.*             - &INPUT   : J:CONV FROM YYDDD TO YYMMDD                 06710002
.*             -          : S:CONV FROM YYMMDD TO YYDDD                 06720002
.*             - &TBL     : Y:GENERATE DATE TABLE FOR EACH MACRO        06730002
.*             -          : N:GENERATE DATE TABLE ONLY ONCE             06740002
.* -EXANPLE    - (1) UDATE        , SET 00YYDDDF TO R1                  06750002
.*             - (2) UDATE WKDATE                                     * 06760002
.*             - (3) UDATE (R2),TODAY=N                                 06770002
.*             - (4) UDATE (R2),TODAY=N,INPUT=S                         06780002
.* I/O CONDITION                                                        06790002
.*  REGISTER NOTATION                                                 * 06800002
.*           R.C     - R15    0:NORMAL                                  06810002
.*                            4:ERR  (ONLY WHEN TODAY = N)              06820002
.*           DESTROY - R14 0:HEINEN                                     06830002
.*                         4:URUUDOSHI                                  06840002
.*                   - R0 :00YYMMDD  (ONLY WHEN INPUT = J)              06850002
.*                   - R1 :00YYDDDF OF TODAY                            06860002
.*           RETURN  - NONE                                           * 06870002
.*     IF NO TOD PARM   R1(HHMMSSTH)  R0(00YYDDDF):CURRENT DAY          06880002
.*     IF TOD PARM      R1(HHMMSSTH)  R0(DDDDDDDF):BACK DAY COUNT       06890002
.* EXAMPLE                                                            * 06900002
.*====================================================================* 06910002
         MACRO                                                          06920002
&NAME    UDATE &AREA,&TODAY=Y,&INPUT=J,&TBL=N                           06930002
.********************************************************************** 06940002
         LCLC  &IX                     FOR LABEL NAMING                 06950002
         LCLC  &TB                                              A#@@@@2 06960002
                                                                        06970002
         GBLB  &UDATEGB                FOR TABLE CREATION SW            06980002
         GBLC  &UDATEGC                FOR TABLE CREATION LABEL         06990002
&IX      SETC  '&SYSNDX'               FOR LABEL NAMING                 07000002
.*                                                                      07010002
         AIF   (NOT &UDATEGB).FIRST                                     07020002
         AIF   ('&TBL' EQ 'N').SECNO                                    07030002
.FIRST   ANOP                                                           07040002
         AIF   ('&NAME' NE '').NAMEOK                                   07050002
.*&TB    SETC  'UDT'.'&IX'            TABLE LABEL          D#@@@@2      07060002
&TB      SETC  'UD'.'&IX'             TABLE LABEL          A#@@@@2      07070002
         AGO   .TOG00                                                   07080002
.NAMEOK  ANOP                                                           07090002
&TB      SETC  '&NAME'                 TABLE LABEL FROM MACRO LABEL     07100002
.TOG00   ANOP                                                           07110002
         AIF   (&UDATEGB).NOTFST                                        07120002
&UDATEGC SETC  '&TB'                   TABLE LABEL FROM MACRO LABEL     07130002
.NOTFST  ANOP                                                           07140002
         AGO   .TOG0                                                    07150002
.*                                                                      07160002
.SECNO   ANOP                          NO TBL CREATION                  07170002
&TB      SETC  '&UDATEGC'              TABLE LABEL FROM MACRO LABEL     07180002
.TOG0    ANOP                                                           07190002
**                                     ***** START MACRO UDATE    ***** 07200002
&NAME    DS    0H                                                       07210002
         AIF   ('&AREA' NE '').OUTAREA                       A#@@@@     07220002
         AIF   ('&TODAY' NE 'Y').ERAREA                      A#@@@@     07230002
         L    R1,16                  GET ADDR OF CVT         A#@@@@     07240002
         L    R1,X'38'(R1)  00YYDDDF CURRENT DATE IN PACKED  A#@@@@     07250002
         MEXIT                                               A#@@@@     07260002
.*.ERRAREA ANOP                        REG TYPE AREA         A#@@@@     07270002
.ERAREA  ANOP                  REG TYPE AREA        A#@@@@      D#@@@@1 07280002
         MNOTE 8,'** MISSING OUTPUT AREA FOR TODAY="N" **'   A#@@@@     07290002
         MEXIT                                               A#@@@@     07300002
.OUTAREA ANOP                          REG TYPE AREA         A#@@@@     07310002
         AIF   ('&AREA'(1,1) NE '(').SAREA S TYPE                       07320002
         LR    R14,&AREA(1)            ADDR AREA FIELD                  07330002
         AGO   .TOG1                                                    07340002
.SAREA   ANOP                          REG TYPE AREA                    07350002
         LA    R14,&AREA               ADDR AREA FIELD                  07360002
.TOG1    ANOP                                                           07370002
         AIF   ('&TODAY' NE 'Y').INPDAY NOT TODAY                       07380002
         AIF   ('&INPUT' EQ 'J').INPOK  NOT TODAY                       07390002
         MNOTE 8,'** UDATE INPUT OPD MUST BE "J" WHEN TODAY ="Y" **'    07400002
.INPOK   ANOP                                                           07410002
         L    R15,16                   GET ADDR OF CVT                  07420002
         L    R15,X'38'(R15)  00YYDDDF CURRENT DATE IN PACKED DECIMAL   07430002
         AGO   .TOG2                                                    07440002
.INPDAY  ANOP                                                           07450002
         MVI  0(R14),0                 CONFIRM TOP BYTE 0               07460002
         AIF   ('&INPUT' NE 'J').YMD1  YMD TO YYDDD                     07470002
         OI   3(R14),X'0F'             CONFIRM SIGN                     07480002
.YMD1    ANOP                                                           07490002
         L    R15,0(R14)               INPUT JULIAN DATE                07500002
.********************************************************************** 07510002
.TOG2    ANOP                                                           07520002
         XC    0(6,R14),0(R14)         CLEAR AREA                       07530002
         MVI   3(R14),X'0C'            ADD SIGN BIT   0000000C0000      07540002
         STCM  R15,B'0100',2(R14)      GET YY*10      0000YY0C0000      07550002
         CLI   2(R14),X'00'            CHK YY             --            07560002
         BE    UDT&IX.D                100 NEN NOT URUUDOSHI            07570002
         DP    0(4,R14),&TB.40         /40(4YEAR)     SSSC0R0C0000      07580002
         CLI   2(R14),X'00'                               --            07590002
         BZ    UDT&IX.1                YES URUU EVERY 4 YEAR            07600002
UDT&IX.D EQU   *                       HEINEN                           07610002
         AIF   ('&TODAY' EQ 'Y').INPH   NOT TODAY                       07620002
         LA    R1,&TB.HE               YEAR END DAY#                    07630002
.INPH    ANOP                                                           07640002
         LA    R0,&TB.H                MONTH TBL TOP ADDR               07650002
         ST    R15,0(R14)              STORE R15 TO WRK                 07660002
         B     UDT&IX.2                COMMON FOR URUU/HEINEN           07670002
UDT&IX.1 EQU   *                       URUDOSI                          07680002
         AIF   ('&TODAY' EQ 'Y').INPX   NOT TODAY                       07690002
         LA    R1,&TB.UE               YEAR END DAY#                    07700002
.INPX    ANOP                                                           07710002
         LA    R0,&TB.U                MONTH TBL TOP ADDR               07720002
         ST    R15,0(R14)              +++++ STORE R15 TO WRK           07730002
         MVI   0(R14),X'F0'            +++++ URUU --> TOP BYTE X'F0'    07740002
         L     R15,0(R14)              +++++ STORE DATE TO R15          07750002
UDT&IX.2 EQU   *                       AFTER CHECK URUU                 07760002
         AIF   ('&TODAY' EQ 'Y').INPU   NOT TODAY                       07770002
         AIF   ('&INPUT' NE 'J').YMD2  YMD TO YYDDD                     07780002
         CP    2(2,R14),&TB.0          CHK ZERO           ----          07790002
         BE    UDT&IX.E                SPECIFICATION ERR                07800002
         CP    2(2,R14),0(2,R1)        CHK YEAR END       ----          07810002
         BH    UDT&IX.E                OVER YEAR END                    07820002
         AGO   .INPU                                                    07830002
.*                                                                      07840002
.* CONV YYMMDD TO YYDDD                                                 07850002
.*                                                                      07860002
.YMD2    ANOP                          00YYMMDD0000                     07870002
.* DD CHK                                                               07880002
         CLI   3(R14),X'00'            CHK DD IS ZERO  00YYMMDD0000     07890002
         BE    UDT&IX.E                SPECIFICATION ERR                07900002
         NI    3(R14),X'0F'            CHK XD          00YYMM0D0000     07910002
         CLI   3(R14),X'09'            CHK XD IS X0 - X9                07920002
         BH    UDT&IX.E                SPECIFICATION ERR                07930002
         STC   R15,3(R14)              00YYMMDD0000                     07940002
         NI    3(R14),X'F0'            CHK DX          00YYMMD00000     07950002
         CLI   3(R14),X'30'            CHK DX    0X - 3X                07960002
         BH    UDT&IX.E                SPECIFICATION ERR                07970002
.* MM CHK                                                               07980002
         CLI   2(R14),X'00'            CHK MM IS ZERO,00YYMMD00000      07990002
         BE    UDT&IX.E                SPECIFICATION ERR                08000002
         TM    2(R14),X'E0'            CHK MM(1X OR 0X)                 08010002
         BNZ   UDT&IX.E                SPECIFICATION ERR                08020002
         MVC   5(1,R14),2(R14)         00YYMMD000MM                     08030002
         NI    5(R14),X'0F'            00YYMMD0000M                     08040002
         CLI   5(R14),X'09'            CHK MM (01 TO 09)                08050002
         BH    UDT&IX.E                SPECIFICATION ERR                08060002
.* GET MM IN BINALY                                                     08070002
         LH    R1,4(R14)               GET .M                           08080002
         TM    2(R14),X'10'            CHK MM(1X OR 0X)                 08090002
         BNO   UDT&IX.K                MM IS 01-09                      08100002
         LA    R1,10(R1)               MM IN BINALY                     08110002
UDT&IX.K EQU   *                                                        08120002
         BCTR  R1,0                    MM TBL OFFSET                    08130002
         BCTR  R1,0                    MM-1   OFFSET                    08140002
         SLL   R1,1                    DAY TBL OFFSET                   08150002
         AR    R1,R0                   MM - 1  MONTH START DAY ADDR     08160002
         ZAP   4(2,R14),0(2,R1)        00------DDDC                     08170002
         MVI   3(R14),X'0C'            00----0CDDDC                     08180002
         STC   R15,1(R14)              00DD--0CDDDC                     08190002
         MVO   2(2,R14),0(2,R14)       00--0DDCDDDC                     08200002
         AP    4(2,R14),2(2,R14)       00------DDDC                     08210002
         LA    R1,2(R1)                MONTH END TBL ADDR               08220002
         CP    4(2,R14),0(2,R1)                ----                     08230002
         BH    UDT&IX.E                SPECIFICATION ERR                08240002
         ZAP   2(2,R14),4(2,R14)       00--DDDC---C                     08250002
         OI    3(R14),X'0F'            00--DDDF---C                     08260002
         STCM  R15,B'0100',1(R14)      00YYDDDF---C                     08270002
         L     R0,0(R14)               FFYYDDDF                         08280002
.*       MVI   0(R14),0                +++++ CONFIRM TOP BYTE 0         08290002
         NI    0(R14),X'01'            KEEP 2000 FLAG                   08300002
         L     R1,0(R14)                                                08310002
         UNPK  0(6,R14),1(3,R14)       F0FYFYFDFDFD                     08320002
         LTR   R0,R0                   +++++ TEST SIGN OF R0            08330002
         BP    UDT&IX.P                +++++                            08340002
         LA    R14,4                   +++++ FLAG=4                     08350002
         B     UDT&IX.R                +++++                            08360002
UDT&IX.P EQU   *                       +++++                            08370002
         LA    R14,0                   +++++ FLAG=0                     08380002
UDT&IX.R EQU   *                       +++++                            08390002
         SR    R15,R15                 R.C                              08400002
         B     UDT&IX.Z                EXIT                             08410002
.*       AGO   .YMD3                                                    08420002
         AGO   .YMD3                   A#@@@3                           08430002
.INPU    ANOP                                                           08440002
         LR    R1,R0                   SAVE TOP ADDR(HEINEN)            08450002
UDT&IX.3 EQU   *                       LOP FOR  CHECK MONTH END         08460002
         CP    2(2,R14),0(2,R1)        CHECK MONTH END    ----          08470002
         BNH   UDT&IX.9                IN MONTH END                     08480002
         LA    R1,2(R1)                NEXT TABLE ENTRY                 08490002
         B     UDT&IX.3                AROUND CONSTANT                  08500002
.YMD3    ANOP                                                           08510002
         AIF   ('&TBL' NE 'N').TBLY                                     08520002
         AIF   (&UDATEGB).NOTFST2                                       08530002
&UDATEGB SETB 1                                                         08540002
.TBLY    ANOP                                                           08550002
&TB.40   DC    PL2'40'                 FOR URUDOSI KEISAN 4 YEAR        08560002
&TB.0    DC    PL2'00'                 MONTH 1 START                    08570002
&TB.H    EQU   *                       MONTH END DATE TABLE 1           08580002
         DC    PL2'31'                 MONTH 1 END                      08590002
         DC    PL2'59'                 MONTH 2 END                      08600002
         DC    PL2'90'                 MONTH 3 END                      08610002
         DC    PL2'120'                MONTH 4 END                      08620002
         DC    PL2'151'                MONTH 5 END                      08630002
         DC    PL2'181'                MONTH 6 END                      08640002
         DC    PL2'212'                MONTH 7 END                      08650002
         DC    PL2'243'                MONTH 8 END                      08660002
         DC    PL2'273'                MONTH 9 END                      08670002
         DC    PL2'304'                MONTH 10 END                     08680002
         DC    PL2'334'                MONTH 11 END                     08690002
&TB.HE   DC    PL2'365'                MONTH 12 END                     08700002
.******** URUUDOSHI DAY TABLE                                           08710002
         DC    PL2'00'                 MONTH 1 START                    08720002
&TB.U    EQU   *                       URUDOSHI DATE TABLE              08730002
         DC    PL2'31'                 MONTH 1 END                      08740002
         DC    PL2'60'                 MONTH 2 END                      08750002
         DC    PL2'91'                 MONTH 3 END                      08760002
         DC    PL2'121'                MONTH 4 END                      08770002
         DC    PL2'152'                MONTH 5 END                      08780002
         DC    PL2'182'                MONTH 6 END                      08790002
         DC    PL2'213'                MONTH 7 END                      08800002
         DC    PL2'244'                MONTH 8 END                      08810002
         DC    PL2'274'                MONTH 9 END                      08820002
         DC    PL2'305'                MONTH 10 END                     08830002
         DC    PL2'335'                MONTH 11 END                     08840002
&TB.UE   DC    PL2'366'                MONTH 12 END                     08850002
.NOTFST2 ANOP                                                           08860002
UDT&IX.9 EQU   *                       FOUND END OF MONTH               08870002
         AIF   ('&INPUT' NE 'J').YMD4  YMD TO YYDDD                     08880002
         ST    R1,0(R14)               SAVE ENTRY ADDR                  08890002
         SR    R1,R0                   ENTRY OFFSET                     08900002
         SRL   R1,1                    DEVIDE BY ENTRY LEN(2)           08910002
         LA    R1,1(R1)                MM IN BINALY                     08920002
         LA    R0,10                   FOR CHECK MONTH 10 OVER          08930002
         CR    R1,R0                   CHECK MONTH                      08940002
         BL    UDT&IX.A                LOW UNDER MONTH 9                08950002
         SR    R1,R0                   N MONTH OVER 10                  08960002
         LA    R0,X'10'                M0 IN PACK                       08970002
         OR    R1,R0                   MM IN PACK                       08980002
UDT&IX.A EQU   *                       AFTER CHECK OVER 10 MONTH        08990002
         STC   R1,5(R14)               SAVE MM IN PACK   AAAAAAAA00MM   09000002
         L     R1,0(R14)               BACK ENTRY ADDR   --------       09010002
         LA    R0,2                    1 ENTRY LEN                      09020002
         SR    R1,R0                    BACK 1 ENTRY                    09030002
         ST    R15,0(R14)              FFYYDDDC00MM +++++ STORE TO R15  09040002
         MVI   0(R14),0                +++++ CONFIRM TOP BYTE 0         09050002
         SP    0(4,R14),0(2,R1)        00YY0DDC00MM                     09060002
         MVC   4(1,R14),1(R14)         00YY0DDCYYMM                     09070002
         MVO   0(3,R14),4(2,R14)       0YYMMDDCYYMM                     09080002
         OI    3(R14),X'0F'            SIGN 4 BIT                       09090002
         L     R0,0(R14)               0YYMMDDC    PACK FMT             09100002
         SRL   R0,4                    00YYMMDD    PACK FMT             09110002
         UNPK  0(6,R14),0(4,R14)       ZONE YYMMDD                      09120002
         L    R1,16                   GET ADDR OF CVT                   09130002
         L    R1,X'38'(R1)  000YYDDDF CURRENT DATE IN PACKED DECIMAL    09140002
         LTR   R15,R15                 +++++ TEST                       09150002
         BP    UDT&IX.P                +++++                            09160002
         LA    R14,4                   +++++ FLAG=4                     09170002
         B     UDT&IX.R                +++++                            09180002
UDT&IX.P EQU   *                       +++++                            09190002
         LA    R14,0                   +++++ FLAG=0                     09200002
UDT&IX.R EQU   *                       +++++                            09210002
         SR   R15,R15                  R.C 0                            09220002
         AIF   ('&TODAY' EQ 'Y').INPZ   NOT TODAY                       09230002
         B    UDT&IX.Z                                                  09240002
.YMD4    ANOP                                                           09250002
UDT&IX.E EQU   *                       R.C SET                          09260002
         LA   R15,4                    R.C 0                            09270002
UDT&IX.Z EQU   *                       R.C SET                          09280002
.INPZ    ANOP                                                           09290002
.*                                                                      09300002
.*                                     ***** END MACRO UDATE    ******* 09310002
         MEND  UDATE                                                    09320002
.*====================================================================* 09330002
.*061123 CSECTNAME/ASMDATE FROM REMOTE PARMLIST                       * 09340002
.*====================================================================* 09350002
.* MACRO NAME : ULSNAP                                                  09360002
.* FORMAT     : &LBL USNAP  &TEXT,&SNAPAREA,&SNAPAREA,,..,&SEQNO=0,     09370002
.*                          &REG=YES,&DDNAME=,&REQ=,&BASEREG=0,         09380002
.*              &LBL       : STMT LABEL AND                             09390002
.*                           IT IS USED TO POINT TEXT AREA              09400002
.*                           TEXT AREA FIELD IS &LBL._TEXT              09410002
.*              &TEXT      : TEXT COMMENT                               09420002
.*              &SNAPAREA  : SNAP FIELD ADDR,SNAP LEN                   09430002
.*                            AREANAME   LENGTH IS L'AREANAME           09440002
.*                            (ADDR,LEN)                                09450002
.*                               ADDR : AREANAME OR (RX) FORMAT         09460002
.*                               LEN  : EQU-VALUE OR (RX) FORMAT        09470002
.*              &SEQNO     : IDENTIFICATION NUMBER                      09480002
.*                         : 0-->65537                                  09490002
.*              &REG       : YES/NO ,REG TRACE OPTION                   09500002
.*                           DEFAULT IS YES                             09510002
.*              &DDNAME    : TO CHANGE OUTPUT DDNAME                    09520002
.*                         : DEFAULT IS ULFSNPDD                        09530002
.*              &BASEREG   : USER BASEREG TO GET CSECT NAME FROM HDR    09540002
.*                         : DEFAULT IS 0,MEANS REG DECLARED AT INIT    09550002
.*                         : IF NO INIT DECLARATION,DEFAULT IS R12      09560002
.* FUNCTION   : SNAP REG AND FIELD CONTENT                              09570002
.* I/O CONDITION :                                                      09580002
.*  ALL REG PRESERVED                                                   09590002
.*  EXIT CONDITION                                                    * 09600002
.*  !!!!! MACRO IS NULIFIED BY SYSPARM=NOSNAP ASSEMBLY OPTION           09610002
.* EXAMPLE  : LBL001 ULSNAP 'AFTER CALL ABC',REG=NO,SEQNO=100           09620002
.*                   ULSNAP AREA1,((R14),(R0)),(AREA2,EQSZ)             09630002
.*                   ULSNAP ((R0),EQDSCTSZ),AH1,AH2,DDNAME=WKDDN        09640002
.*====================================================================* 09650002
         MACRO                                                          09660002
&X       ULSNAP &TEXT,&SEQNO=1,&REG=YES,&DDNAME=,&BASEREG=0             09670002
                                                                        09680002
         LCLA  &I                       INDEX  SYSLIST                  09690002
         LCLA  &PERLIST                 SAVE SYSLIST START/ADDR/PARA    09700002
         LCLC  &STRING                  CONSTRUCT STRING WITH L         09710002
         LCLC  &YSCTNA                 NAME CONTROLCSECT                09720002
         LCLA &OPT,&OPT2,&NN                                    R#@@@@2 09730002
         LCLC &WKOPTC,&TLABEL                                   R#@@@@2 09740002
         GBLC &CSECTTB(100)      ONCE GENERATE CSECTNAME AND ASMDATE    09750002
         GBLA &CSECTNO           INDEX                                  09760002
         LCLB &CSECTSW                                                  09770002
         LCLC &CSECTNM                                                  09780002
         LCLA &II                                                       09790002
*                                 START MACRO ULSNAP ****************** 09800002
.*                                 PROCESS LABEL                        09810002
&X       DS    0H                       ON HALFW BOUNDARY/JUST IN CASE  09820002
.*                                 DO COMMENT FOR BETTER REFERENCE      09830002
&I       SETA  1                        TO TEST FOR TEXT                09840002
.*                                 TEST TO AVOID DIAGNOSTICS/NO POS OP  09850002
         AIF   ('&SYSLIST(&I)' EQ '').NOPOS   BRANCH NO POSITIONAL OPER 09860002
         AIF   ('&SYSLIST(&I)'(1,1) EQ '''').F1                         09870002
         AGO   .TOG1                                                    09880002
.*                                 NO POSITIONAL OPERAND SPECIFIED      09890002
.NOPOS   ANOP                                                           09900002
         MNOTE *,'ULSNAP MACRO:NO TEXT SPECIFIED/NO ADDRESS SPECIFIED'  09910002
         AGO   .TOG1                                                    09920002
.*                                 TEXT IS PRESENT                      09930002
.F1      ANOP                                                           09940002
&I       SETA  2                        SET INDEX POSITIONAL PARA/START 09950002
.TOG1    ANOP                                                           09960002
.OK1     ANOP                                                           09970002
         AIF   ('&REG' EQ 'NO' OR '&REG' EQ 'YES').OK2                  09980002
         MNOTE 8,'ULSNAP MACRO:REG OPERAND IS NOT YES/NO'               09990002
*                                 END MACRO ULSNAP  ******************* 10000002
.OK2     ANOP                                                           10010002
         AIF   ('&SYSPARM' NE 'NOSNAP').IGNORNO NOP MACRO TEST          10020002
.*                                      MACRO IS IGNORED                10030002
*                                       ULSNAP MACRO IGNORED/SYSPARM    10040002
*                                       NOSNAP HAS BEEN USED            10050002
*                                 END MACRO ULSNAP  ******************* 10060002
         MEXIT                                                          10070002
.*********************************************************************  10080002
.IGNORNO  ANOP                          MACRO NOT IGNORED               10090002
         LCLC  &LNKCSCT                                                 10100002
&LNKCSCT SETC  'XE4S002Z'         * LINKAGE PGM CSECT NAME              10110002
.*                                                                      10120002
&PERLIST SETA  &I                       SAVE POSIOTION/ADDRESS PARA     10130002
.*                                 BUILD NAME OF PRINTCONTROLCSECT      10140002
.*                                                                      10150002
.* SEARCH CSECT TBL                                                     10160002
&II      SETA  0                                                        10170002
.LOOP    ANOP                                                           10180002
&II      SETA  &II+1                                                    10190002
         AIF (&II GT &CSECTNO).NOTF                                     10200002
         AIF ('&SYSECT' EQ '&CSECTTB(&II)').FOUND                       10210002
         AGO  .LOOP                                                     10220002
.FOUND   ANOP                                                           10230002
&CSECTSW SETB  0                                                        10240002
         AGO   .COM1                                                    10250002
.NOTF    ANOP                                                           10260002
&CSECTSW SETB  1                                                        10270002
&CSECTNO SETA  &CSECTNO+1                                               10280002
&CSECTTB(&CSECTNO) SETC '&SYSECT'                                       10290002
.COM1    ANOP                                                           10300002
&CSECTNM SETC '&SYSECT'                                                 10310002
.*                                                                      10320002
.*                                                                      10330002
&YSCTNA SETC  '@'.'&SYSECT'(1,7)   UNIQUE NAME PRINTCONTROLCSECT        10340002
         STM   R14,R12,12(R13)     BY SA=CURRENT SPECIFICATION          10350002
         L R15,=V(&LNKCSCT)        INTERFACE MODULE                     10360002
         CNOP  2,4                                                      10370002
         BALR  R14,R15             REMOTE PARM FROM R14+4               10380002
         B     *+8                                                      10390002
         DC    A(#@#U&SYSNDX)      REMOTE PARM                          10400002
         LM    R14,R12,12(R13)     RESTORE REG                          10410002
.*********************************************************************  10420002
&YSCTNA CSECT                          CONTROLSECT PRINT                10430002
         AIF (NOT &CSECTSW).NONAME                                      10440002
         DC  CL8'&CSECTNM'                                              10450002
         DC  CL8'&SYSDATE'                                              10460002
         DC  CL6'&SYSTIME'                                              10470002
.NONAME  ANOP                                                           10480002
.*SETUP OPTION                                                          10490002
&NN      SETA  1                                                        10500002
&OPT     SETA 0                                                         10510002
&OPT2    SETA 0                                                         10520002
&WKOPTC  SETC 'OPT='                                                    10530002
         AIF ('&TEXT' EQ '').NOTXT3                                     10540002
         AIF ('&TEXT'(1,1) NE '''').NOTXT3                              10550002
&OPT     SETA &OPT+1                   TEXT EXIST OPTION                10560002
&WKOPTC  SETC '&WKOPTC'.'TEXT '                                         10570002
.NOTXT3  ANOP                                                           10580002
         AIF ('&REG' EQ 'NO').NOREG3                                    10590002
&OPT     SETA &OPT+2                   REG TRACE  OPTION                10600002
&WKOPTC  SETC '&WKOPTC'.'REG=YES '                                      10610002
.NOREG3  ANOP                                                           10620002
         AIF ('&DDNAME' EQ '').NODDN3                                   10630002
&NN      SETA &NN+1                   DDNAME     OPTION                 10640002
&OPT     SETA &OPT+4                   DDNAME     OPTION                10650002
&WKOPTC  SETC '&WKOPTC'.'DDNAME '                                       10660002
         AIF ('&DDNAME'(1,1) NE '''').NODDN3                            10670002
&OPT     SETA &OPT+8                   LITERAL DDNAME OPTION            10680002
&WKOPTC  SETC '&WKOPTC'.'CONST DDN '                                    10690002
.NODDN3  ANOP                                                           10700002
.*                                                                      10710002
#@#U&SYSNDX DS 0F                       REFERENCED BY ADDRESS INLINE    10720002
&WKOPTC  SETC 'AL1(&OPT) &WKOPTC'                                       10730002
         DC    A(&YSCTNA)                CSECT TOP                      10740002
         DC    AL2(&SEQNO)              SEQ NUMBER ULSNAP               10750002
         DC    &WKOPTC                                                  10760002
         DC    AL1(&OPT2+&BASEREG)                                      10770002
         AIF ('&DDNAME' EQ '').NODDN4                                   10780002
         AIF ('&DDNAME'(1,1) EQ '''').DDNCONS                           10790002
         AIF ('&DDNAME'(1,1) EQ '(').DDNREG                             10800002
         DC   SL2(&DDNAME)         DDNAME PTR                           10810002
         AGO .NODDN4                                                    10820002
.DDNREG  ANOP                                                           10830002
         DC    AL2(16*256*&DDNAME(1)) REGISTER NOTATION DDNAME          10840002
         AGO .NODDN4                                                    10850002
.DDNCONS ANOP                                                           10860002
         DC  CL8&DDNAME            DDNAME CONSTANT                      10870002
.NODDN4  ANOP                                                           10880002
.*                                 WORK ON TEXT                         10890002
&I       SETA  1                        TO TEST FOR TEXT                10900002
         AIF   ('&SYSLIST(&I)' EQ '').BLANKT BRANCH NO POSITIONAL PREST 10910002
         AIF   ('&SYSLIST(&I)'(1,1) NE '''').BLANKT BRCH NO QUOTES      10920002
.*                                 TEXT IS PRESENT                      10930002
&TLABEL  SETC 'SNP&SYSNDX.T'                                            10940002
.*                                 TEXT IS PRESENT                      10950002
         DC    AL2(L'&TLABEL)                                           10960002
&TLABEL  DC    C&TEXT                   TEXT/FIRST OPERAND/USNAP        10970002
.BLANKT  ANOP                           ENTRY POINT NO TEXT             10980002
.*                                 WORK ON ADDRESSES                    10990002
&I       SETA  &PERLIST                 RESTORE START ADDRESS           11000002
.LOOPGEN ANOP                      GENERATE LIST/LOOP/FIELD             11010002
         AIF   ('&SYSLIST(&I)' EQ '').NOTPR BRANCH FIELD NOT PRESENT    11020002
.*                                 FIELD PRESENT TEST IF LENGTH PRESENT 11030002
         AIF ('&SYSLIST(&I,2)' EQ '').NOLEN BRANCH NO LEN PARA          11040002
.*                                 LENGTH IS STATED IN OPERAND          11050002
.*                                 TEST IF LENGTH IN REG NOTATION       11060002
         AIF   ('&SYSLIST(&I,2)'(1,1) EQ '(').REGNOT1                   11070002
.*                                 LENGTH NOT IN REGISTER NOTATION      11080002
         DC    AL2(&SYSLIST(&I,2))      LENGTH/FIELD/AS PER OPERAND     11090002
         AGO   .TOLEN                                                   11100002
.*                                 LENGTH IS IN REGISTER NOTATION       11110002
.REGNOT1 ANOP                                                           11120002
         DC    XL1'80'                  LENGTH IS IN REG NOTATION       11130002
         DC    AL1(&SYSLIST(&I,2))      LENGTH/REGISTER NOTATION        11140002
         AGO   .TOLEN                                                   11150002
.*                                 LENGTH IS NOT SPECIFIED/USE IMPLIED  11160002
.NOLEN   ANOP                                                           11170002
.*                                 WORK ON IMPLIED LENGTH               11180002
.*                                 TEST IF FIELD IN REG NOTATION        11190002
.*                                 REG HAS NO IMPLIED LENGTH            11200002
         AIF   ('&SYSLIST(&I,1)'(1,1) EQ '(').REGNOT3                   11210002
.*       AIF   ('&SYSLIST(&I)'(1,1) EQ '(').REGNOT3 ALSO PERMITTED      11220002
.*       MNOTE '&SYSLIST(&I)'                                           11230002
.*                                 NO LENGTH SPECIFIED/FIELD NOT PRESEN 11240002
.*                                 CONSTRUCT PROPER STRING              11250002
&STRING  SETC  'L''&SYSLIST(&I,1)'      CONSTRUCT L/STRING              11260002
         DC    AL2(&STRING)             LENGTH/FIELD/IMPLIED            11270002
.*                                 LENGTH SPECIFIED/FIELD REG OR NOT    11280002
.TOLEN   ANOP                                                           11290002
.*                                      TEST FOR REGISTER NOTATION/FIEL 11300002
.*                                 IF LENGTH IS SPECIFIED DOUBLE PAR    11310002
.*                                 ARE REQ FOR REG NOTATION FIELD       11320002
         AIF   ('&SYSLIST(&I,1)'(1,1) EQ '(').REGNOT2 IF LENGTH/DOUBLE  11330002
.*                                 FIELD NOT REGISTER NOTATION          11340002
         DC    SL2(&SYSLIST(&I,1))      ADDRESS/FIELD                   11350002
         DC    CL8'&SYSLIST(&I,1)'      NAME/FIELD                      11360002
&I       SETA  &I+1                     NEXT FIELD TO BE TESTED/INDEX   11370002
         AGO   .LOOPGEN                 PROCESS IN LOOP                 11380002
.*                                 ADDRESS IN REGNOTATION/NO LENGTH SPE 11390002
.REGNOT3 ANOP                                                           11400002
         DC    AL2(100)                 LENGTH/DEFAULT/FIELD IN REGNOTA 11410002
.*                                 ADDRESS IS IN REG NOTATION           11420002
.*                                 ENTRY POINT LEN SPEC/FIELD REG NOTA  11430002
.REGNOT2 ANOP                                                           11440002
         DC    AL2(16*256*&SYSLIST(&I,1)) REGISTER NOTATION/FIELD       11450002
         DC    CL8'&SYSLIST(&I,1)'      NAME/FIELD                      11460002
&I       SETA  &I+1                     NEXT FIELD                      11470002
         AGO   .LOOPGEN                                                 11480002
.*                                 ALL FIELDS/PARAMRTR PROCESSED        11490002
.NOTPR   ANOP                                                           11500002
         DC    X'FF'                    END PARAMETER LIST/ULSNAP MACRO 11510002
&SYSECT  CSECT                          RESUME PROGRAM CSECT            11520002
**********                       END MACRO ULSNAP  ******************** 11530002
         MEND  ULSNAP                                                   11540002
.********************************************************************** 11550002
         MACRO                                                          11560002
&NAME    UERREXIT &MSG                                                  11570002
         LA R0,&MSG                                                     11580002
         BAL R14,ERRMSG                                                 11590002
         MEND  UERREXIT                                                 11600002
.********************************************************************** 11610002
*********************************************************************** 11620002
         GBLSET                 FOR INLINE MACRO                        11630002
*        REGISTER               REG EQU D#004                           11640008
         UEQUGPR                REG EQU A#004                           11641008
*********************************************************************** 11650002
XE4S001Z CSECT                                                          11660002
         SAVE (14,12)                                                   11670002
         USING XE4S001Z,R12,R11,R10,R9                                  11680002
         LR R12,R15                                                     11690002
         LA R9,4095                                                     11700002
         LA R9,1(R9)                                                    11710002
         LR R11,R12                                                     11720002
         AR R11,R9                                                      11730002
         LR R10,R11                                                     11740002
         AR R10,R9                                                      11750002
         AR R9,R10                                                      11760002
         ST R15,8(R13)                                                  11770002
         ST R13,4(R15)                                                  11780002
         LR R13,R15                                                     11790002
*                                                                       11800002
         USING PDS2,R3                                                  11810002
         USING S99RB,R4                ESTABLISH ADDRSBLTY FOR RB       11820002
*                                                                       11830002
         LR R5,R1                      PARMREG                          11840002
*                                                                       11850002
         MVC DCBDDNAM-IHADCB+OUTDCB,BLANK                               11860002
         BAL R14,GETTJID               GET TSO JOBID TO CHK UNDER TSO   11870002
         BAL R14,SOALLOC                                                11880002
         MVC DCBDDNAM-IHADCB+OUTDCB,RETDDN                              11890002
         OPEN (OUTDCB,(OUTPUT))        SYSOUT                           11900002
         IF (TM,DCBOFLGS-IHADCB+OUTDCB,DCBOFOPN,NO)                     11910002
           MVC ERRMSG04(8),DCBDDNAM-IHADCB+OUTDCB                       11920002
           UERREXIT ERRMSG04                                            11930002
         ENDIF                                                          11940002
*                                                                       11950002
         BAL R14,PXMSESTS        ESTAE SET                              11960002
         BAL R14,GETPARM         CHECK EXEC PARM                        11970002
         MVC DCBDDNAM-IHADCB+PDSDCB,BLANK      NOT ALLOC ID             11980002
         MVC DCBDDNAM-IHADCB+PDSDCB2,BLANK     NOT ALLOC ID             11990002
         MVC DCBDDNAM-IHADCB+PDSDCB3,BLANK     NOT ALLOC ID             12000002
         BAL R14,DSALLOC                                                12010002
         MVC DCBDDNAM-IHADCB+PDSDCB,RETDDN                              12020002
         MVC DCBDDNAM-IHADCB+PDSDCB2,RETDDN                             12030002
         MVC DCBDDNAM-IHADCB+PDSDCB3,RETDDN                             12040002
*CONFIRM PDS                                                            12050002
         BAL R14,DSINFO                                                 12060002
         IF (CLI,WFUNCID,E,EQFSPFUP)  FUNCTION ID=UPDDATE         A#002 12070002
           BAL R14,SPFUPDAT                                       A#002 12080002
           B EXIT                                                 A#002 12090002
         ENDIF                                                    A#002 12100002
*DIRECTORY PROCESS                                                      12110002
         OPEN (PDSDCB2,(INPUT))                                         12120002
         IF (TM,DCBOFLGS-IHADCB+PDSDCB2,DCBOFOPN,NO)                    12130002
           MVC ERRMSG02+3(8),DCBDDNAM-IHADCB+PDSDCB2                    12140002
           LA R0,ERRMSG02                                               12150002
           BAL R14,ERRMSG                                               12160002
         ENDIF                                                          12170002
         BAL R14,DISPHDR                                                12180002
       IF (CLI,PARMMEMB,NE,C' ')    MEMBERNAME SPECIFIED      A#001     12190002
         LA R2,PDSDCB2                DCB ADDR:PARM TO BLDLMEMB         12200002
         BAL R14,BLDLMEMB                                     A#001     12210002
         LA R3,BLDLPENT               PDS2 BASE                         12220002
         BAL R14,DISPMEMB                                     A#001     12230002
       ELSE                                                             12240002
         DO INF                                                         12250002
           XC DECB(4),DECB         * DECB CLEAR                         12260002
           READ DECB,SF,PDSDCB2,DIRAREA,'S'                             12270002
           CHECK DECB                                                   12280002
           LH R5,DIRAREA       *LL                                      12290002
           LA R3,DIRAREA+2                                              12300002
           SH R5,=H'2'                                                  12310002
           DO WHILE=(LTR,R5,R5,P)                                       12320002
             IF (CLC,PDS2NAME,EQ,=8XL1'FF')    * END MEMBER             12330002
               B EOFDIR                                                 12340002
             ENDIF                                                      12350002
             BAL R14,DISPMEMB                                           12360002
             IC R4,PDS2INDC                                             12370002
             N R4,=A(PDS2LUSR)     USER AREA LENGTH MASK                12380002
             SLL R4,1            LEN IS HALFWORD COUNT                  12390002
             LA R4,PDS2USRD-PDS2(R4)                                    12400002
             AR R3,R4                                                   12410002
             SR R5,R4                                                   12420002
           ENDDO                                                        12430002
         ENDDO                                                          12440002
EOFDIR   EQU *                                                          12450002
       ENDIF                                                            12460002
         BAL R14,PUTENDL                                                12470002
         LA R15,0                                                       12480002
EXIT     EQU *                                                          12490002
         BAL R14,CLOSEFRE                                               12500002
         L R13,4(R13)                                                   12510002
         RETURN (14,12),RC=(15)                                         12520002
**********************************************************************  12530002
* PRINT END OF LIST                                         A#002       12540002
**********************************************************************  12550002
PUTENDL  DS 0H                                                          12560002
         ST R14,SVR14EL                                                 12570002
*                                                                       12580002
         L R2,LINENO                                                    12590002
         UI2Z (R2),HDR3+14,LEN=6                                        12600002
         L R2,ALIASNO                                                   12610002
         UI2Z (R2),HDR3+29,LEN=6                                        12620002
         LA R0,HDR3                                                     12630002
         BAL R14,ERRMSG                                                 12640002
*                                                                       12650002
         L  R14,SVR14UP                                                 12660002
         BR R14                                                         12670002
****************                                                        12680002
SVR14EL  DS F                                                           12690002
HDR3     DC    CL80'-END OF LIST- XXXXXX MEMBER (XXXXXX ALIAS)'         12700002
**********************************************************************  12710002
* SPF INFO UPDATE                                           A#002       12720002
**********************************************************************  12730002
SPFUPDAT DS 0H                                                          12740002
         ST R14,SVR14UP                                                 12750002
*                                                                       12760002
         IF (TM,SPFSW,EQUSPFF,NO)     RECFM=F,LRECL=80                  12770002
           UERREXIT ERRMSG09                                            12780002
         ENDIF                                                          12790002
*                                                                       12800002
         LA R2,PDSDCB3                                                  12810002
         OPEN ((R2),(UPDAT))                                            12820002
         IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,NO)                        12830002
           MVC ERRMSG02+3(8),DCBDDNAM-IHADCB(R2)                        12840002
           UERREXIT ERRMSG02                                            12850002
         ENDIF                                                          12860002
         IF (CLI,PARMMEMB,E,C' ') //NO MEMBER PARM                      12870002
           UERREXIT ERRMSGMM                                            12880002
         ENDIF                                                          12890002
         LA R1,8                                                        12900002
         UMEMCHR PARMMEMB,C'*',(R1)                               A#003 12910002
 ULSNAP 'WILDC   '                                                      12920002
         IF (LTR,R1,R1,Z)                                         A#003 12930002
           LA R1,8                                                      12940002
           UMEMCHR PARMMEMB,C'?',(R1)                             A#003 12950002
         ENDIF                                                    A#003 12960002
 ULSNAP 'WILDC   '                                                      12970002
         IF (LTR,R1,R1,NZ)  WILDCARD                              A#003 12980002
           BAL R14,SPFUPDT2                                       A#003 12990002
         ELSE                                                           13000002
           BAL R14,DISPHDR                                              13010002
           BAL R14,SPFUPDTM                                             13020002
         ENDIF                                                    A#003 13030002
*                                                                       13040002
         BAL R14,PUTENDL                                                13050002
         L  R14,SVR14UP                                                 13060002
         BR R14                                                         13070002
****************                                                        13080002
SVR14UP  DS F                                                           13090002
ERRMSGMM DC CL80' * MEMBER NAME REQUIRED(USE * TO APPLY TO WHOLE D/S'   13100002
**********************************************************************  13110002
* SPF INFO UPDATE FOR MEMBERS                               A#003       13120002
**********************************************************************  13130002
SPFUPDT2 DS 0H                                                          13140002
         ST R14,SVR14UP2                                                13150002
*                                                                       13160002
         MVC WILDMEMB,PARMMEMB                                          13170002
         LA R0,EOFDIR2                                                  13180002
         STCM R0,B'0111',DCBEODA-IHADCB+PDSDCB2                         13190002
         OPEN (PDSDCB2,(INPUT))                                         13200002
         IF (TM,DCBOFLGS-IHADCB+PDSDCB2,DCBOFOPN,NO)                    13210002
           MVC ERRMSG02+3(8),DCBDDNAM-IHADCB+PDSDCB2                    13220002
           LA R0,ERRMSG02                                               13230002
           BAL R14,ERRMSG                                               13240002
         ENDIF                                                          13250002
*GET MEMBERNAME(DUP MEMBER READ IF REPEAT REAN/UPDATE)                  13260002
         DO INF                                                         13270002
           XC DECB2(4),DECB2         * DECB CLEAR                       13280002
           READ DECB2,SF,PDSDCB2,DIRAREA,'S'                            13290002
           CHECK DECB2                                                  13300002
 ULSNAP 'DIR READ',(DIRAREA,256)                                        13310002
           LH R5,DIRAREA       *LL                                      13320002
           LA R3,DIRAREA+2                                              13330002
           SH R5,=H'2'                                                  13340002
           DO WHILE=(LTR,R5,R5,P)                                       13350002
             IF (CLC,PDS2NAME,EQ,=8XL1'FF')    * END MEMBER             13360002
               B EOFDIR2                                                13370002
             ENDIF                                                      13380002
             IF (CLI,WILDMEMB,NE,C' ')                                  13390002
               LA R1,PDS2NAME                                           13400002
               LA R2,WILDMEMB            WILDCARD                       13410002
               BAL R14,WILDCHK                                          13420002
             ELSE                                                       13430002
               SR R15,R15                                               13440002
             ENDIF                                                      13450002
             IF (LTR,R15,R15,Z)     //WILDCARD MATCH                    13460002
               LA R0,12             PTR AND MEMBNAME                    13470002
               GETMAIN RC,LV=(R0)                                       13480002
               IF (LTR,R15,R15,NZ)                                      13490002
                 UERREXIT ERRMSG21                                      13500002
               ENDIF                                                    13510002
               LR R2,R1                                                 13520002
               L R1,MEMBLIST                                            13530002
               IF (LTR,R1,R1,Z)     1ST MEMBER                          13540002
                 ST R2,MEMBLIST                                         13550002
                 ST R2,MEMBLSTE                                         13560002
               ELSE                                                     13570002
                 L R1,MEMBLSTE      LAST ENTRY                          13580002
                 ST R2,0(R1)        CHAIN TO LAST                       13590002
                 ST R2,MEMBLSTE                                         13600002
               ENDIF                                                    13610002
               XC 0(4,R2),0(R2)     NEXT CHAIN                          13620002
               MVC 4(8,R2),PDS2NAME                                     13630002
             ENDIF                                                      13640002
             IC R4,PDS2INDC                                             13650002
             N R4,=A(PDS2LUSR)     USER AREA LENGTH MASK                13660002
             SLL R4,1            LEN IS HALFWORD COUNT                  13670002
             LA R4,PDS2USRD-PDS2(R4)                                    13680002
             AR R3,R4                                                   13690002
             SR R5,R4                                                   13700002
           ENDDO                                                        13710002
         ENDDO                                                          13720002
EOFDIR2  EQU *                                                          13730002
*                                                                       13740002
         CLOSE (PDSDCB2)                                                13750002
         BAL R14,DISPHDR                                                13760002
         L R3,MEMBLIST                                                  13770002
         IF (LTR,R3,R3,Z)                                               13780002
            UERREXIT ERRMSG22                                           13790002
         ENDIF                                                          13800002
         DO WHILE=(LTR,R3,R3,NZ)                                        13810002
           SR R0,R0                                                     13820002
           BCTR R0,0                                                    13830002
           ST R0,WLINENO                 RESET FOR EACH MEMBER          13840002
           ST R0,WMAXMM                                                 13850002
           MVC PARMMEMB,4(R3)                                           13860002
           BAL R14,SPFUPDTM                                             13870002
           LR R2,R3                                                     13880002
           L R3,0(R3)      NEXT MEMBER                                  13890002
           LA R0,12                                                     13900002
           FREEMAIN  RU,A=(R2),LV=(R0)                                  13910002
         ENDDO                                                          13920002
*                                                                       13930002
         L  R14,SVR14UP2                                                13940002
         BR R14                                                         13950002
****************                                                        13960002
SVR14UP2 DS F                                                           13970002
WILDMEMB DS CL8                                                         13980002
MEMBLIST DC F'0'    TOP ENTRY                                           13990002
MEMBLSTE DC F'0'    LAST ENTRY                                          14000002
ERRMSG21 DC CL80' * GETMAIN FOR PDS MEMBER FAILED'                      14010002
ERRMSG22 DC CL80' * NO MEMBER MATCH TO THE WILDCARD EXIST'              14020002
ERRMSG23 DC CL80' * NO MEMBER EXIST IN THE DATASET'                     14030002
**********************************************************************  14040002
* SPF INFO UPDATE FOR MEMBER OF MEMBERS                     A#003       14050002
**********************************************************************  14060002
SPFUPDTM DS 0H                                                          14070002
         STM R0,R15,SVRUPM                                              14080002
*                                                                       14090002
         LA R2,PDSDCB3                                                  14100002
         LA R3,BLDLPENT               PDS2 BASE                         14110002
         BAL R14,BLDLMEMB             R2:PARM DCB ADDR        A#001     14120002
         BAL R14,DISPMEMB                                     A#001     14130002
         ULSNAP 'BEFORE UPDATE',(PDS2NAME,DIRESZ)                       14140002
         IF (TM,SPFSW,EQUOTHER,NO)     NOT SPF AND NOT NULL INFO        14150002
           IF (TM,SPFSW,EQUSPFI,NO)    NO SPF INFO                      14160002
              XC PDS2USRD(SPFISZ),PDS2USRD                              14170002
              MVI PDS2INDC,PDS2SPFI SPF INFO DATALEN=0F(30 BYTE)        14180002
           ENDIF                                                        14190002
           BAL R14,GETSPFPM                                             14200002
           ULSNAP 'STOW DATA',(PDS2NAME,DIRESZ)                         14210002
           STOW  PDSDCB3,PDS2NAME,R      REPLACE OPTION                 14220002
           ULSNAP 'STOW REPLACE AFTER',(PDS2NAME,DIRESZ)                14230002
           IF (LTR,R15,R15,NZ)                                A#005     14231018
             MVC ERRMSGSE+19(8),PDS2NAME                      A#005     14232018
             UI2X     (R15),ERRMSGSE+19+8+4                   A#005     14233018
             UERREXIT ERRMSGSE                                A#005     14234018
           ENDIF                                              A#005     14235018
         ENDIF                                                          14240002
         LA R3,BLDLPENT               PDS2 BASE                         14250002
         MVI DISPUPDT,1               PARM TO DISPMEMB                  14260002
         BAL R14,DISPMEMB                                     A#001     14270002
         MVI DISPUPDT,0                                                 14280002
*                                                                       14290002
SPFUPDME DS 0H                                                          14300002
         LM  R0,R15,SVRUPM                                              14310002
         BR R14                                                         14320002
****************                                                        14330002
SVRUPM   DS 16F                                                         14340002
ERRMSGSE DC CL80' * STOW FAILED FOR XXXXXXXX RC=XXXXXXXX *' A#005       14341018
**********************************************************************  14350002
* WILDCARD COMPARE R1:MEMBERNAME TO BE CHKED,R2:WILDCARD                14360002
**********************************************************************  14370002
WILDCHK  DS 0H                                                          14380002
         STM R14,R3,SVRWC                                               14390002
*                                                                       14400002
 ULSNAP 'WILDCHK',((R1),8),((R2),8)                                     14410002
         L R3,WILDLEN                                                   14420002
         IF (LTR,R3,R3,Z)                                               14430002
           LR R15,R2                                                    14440002
           DO FROM=(R0,8)                                               14450002
           DOEXIT (CLI,0(R15),E,C' ')                                   14460002
             LA R3,1(R3)                                                14470002
             LA R15,1(R15)                                              14480002
           ENDDO                                                        14490002
           ST R3,WILDLEN                                                14500002
         ENDIF                                                          14510002
         LR R15,R1                                                      14520002
         SR R14,R14                                                     14530002
         DO FROM=(R0,8)                                                 14540002
         DOEXIT (CLI,0(R15),E,C' ')                                     14550002
           LA R14,1(R14)                                                14560002
           LA R15,1(R15)                                                14570002
         ENDDO                                                          14580002
         LR R0,R14                 MEMBNAME LEN                         14590002
*                                                                       14600002
         SR R15,R15                RC                                   14610002
         DO WHILE=(LTR,R3,R3,P)                                         14620002
           IF (CLI,0(R2),E,C'*')                                        14630002
             DO WHILE=(LTR,R3,R3,P)                                     14640002
             DOEXIT (CLI,0(R2),NE,C'*'),AND,(CLI,0(R2),NE,C'?')         14650002
               LA R2,1(R2)                                              14660002
               BCTR R3,0                                                14670002
             ENDDO                                                      14680002
             IF (LTR,R3,R3,NP)          LAST *                          14690002
  ULSNAP 'WILDCHK6',((R2),1),((R1),1)                                   14700002
               B WILDCHKE                                               14710002
             ENDIF                                                      14720002
             DO WHILE=(LTR,R0,R0,P)                                     14730002
             DOEXIT (CLC,0(1,R2),EQ,0(R1))                              14740002
               LA R1,1(R1)                                              14750002
               BCTR R0,0                                                14760002
             ENDDO                                                      14770002
             IF (LTR,R0,R0,NP)          NEXT CHAR OF '*' NOT FOUND      14780002
  ULSNAP 'WILDCHK7',((R2),1),((R1),1)                                   14790002
               LA R15,4                                                 14800002
               B WILDCHKE                                               14810002
             ENDIF                                                      14820002
           ELSE                      MOT "*"                            14830002
             IF (LTR,R0,R0,NP)       NO TARGET BUT MORE WORD            14840002
  ULSNAP 'WILDCHK3',((R2),1),((R1),1)                                   14850002
               LA R15,4                                                 14860002
               B WILDCHKE                                               14870002
             ENDIF                                                      14880002
             IF (CLI,0(R2),NE,C'?'),AND,(CLC,0(1,R1),NE,0(R2))  UNMATCH 14890002
  ULSNAP 'WILDCHK2',((R2),1),((R1),1)                                   14900002
               LA R15,4                                                 14910002
               B WILDCHKE                                               14920002
             ENDIF                                                      14930002
           ENDIF                                                        14940002
           LA R1,1(R1)                                                  14950002
           LA R2,1(R2)                                                  14960002
           BCTR R0,0                                                    14970002
           BCTR R3,0                                                    14980002
         ENDDO                                                          14990002
         SR R15,R15                                                     15000002
WILDCHKE EQU *                                                          15010002
 ULSNAP 'WILDCHK RC=R15'                                                15020002
*                                                                       15030002
         L R14,SVRWC                                                    15040002
         LM  R0,R3,SVRWC+4*2                                            15050002
         BR R14                                                         15060002
****************                                                        15070002
SVRWC    DS 6F                                                          15080002
WILDLEN  DC F'0'                                                        15090002
**********************************************************************  15100002
* ANALYZE EXEC PARM                                                     15110002
**********************************************************************  15120002
GETPARM  DS 0H                                                          15130002
         ST R14,SVR14GP                                                 15140002
*                                                                       15150002
         L R1,0(R5)                                                     15160002
         LH R2,0(R1)                   * REG2 = PARM LENGTH             15170002
         LA R1,2(R1)                   PARM TOP                   A#002 15180002
 ULSNAP 'EXE PARM',((R1),(R2))                                   A#002  15190002
         IF (CH,R2,H,=Y(2))                                       A#002 15200002
           IF (CLC,0(2,R1),EQ,=C'1,')  FUNCTINID:UPDATE SPF INFO  A#002 15210002
             MVI WFUNCID,EQFSPFUP                                 A#002 15220002
             LA R1,2(R1)               DSN TOP                    A#002 15230002
             SH R2,=Y(2)               PARM LEN                   A#002 15240002
             LR R3,R1                                             A#002 15250002
             LR R4,R2                                             A#002 15260002
             UMEMCHR (R3),C',',(R4)                               A#002 15270002
             IF (LTR,R1,R1,NZ)                                    A#002 15280002
               LA R15,1(R1)            SPF PARM START ADDR        A#002 15290002
               LA R14,0(R3,R4)         PARM END                   A#002 15300002
               SR R14,R15              SPF PARM LEN               A#002 15310002
               LR R2,R1                DSN END ADDR               A#002 15320002
               SR R2,R3                DSN LENGTH                 A#002 15330002
             ELSE                                                 A#002 15340002
               LA R14,0                SPF PARM LEN               A#002 15350002
               LR R2,R4                DSN LENGTH                 A#002 15360002
             ENDIF                                                A#002 15370002
             LR R1,R3                  DSN ADDR                   A#002 15380002
             ST R15,WSPFPA             SPF PARM ADDR              A#002 15390002
             ST R14,WSPFPL             SPF PARM LEN               A#002 15400002
 ULSNAP 'SPFPARM',((R15),(R14))                                   A#002 15410002
           ENDIF                       FUNCTINID:UPDATE SPF INFO  A#002 15420002
         ENDIF                                                          15430002
         LR R15,R2                                                      15440002
         BCTR R15,0                                                     15450002
       IF (LTR,R15,R15,NM)                                        A#004 15451014
         EX R15,MVCHDR1                                                 15460002
       ENDIF                                                      A#004 15461014
         IF (LTR,R2,R2,Z)                                               15470002
           LA R0,ERRMSG03                                               15480002
           BAL R14,ERRMSG                                               15490002
         ELSE                                                           15500002
*          LA R1,2(R1)                                            D#002 15510002
           LR R3,R1                                                     15520002
           UMEMCHR (R3),C'(',(R2)                                       15530002
           IF (LTR,R1,R1,NZ)      FOUND                                 15540002
             LA R14,1(R1)         MEMBNAME ADDR                         15550002
             SR R1,R3             DSN LEN                               15560002
             LR R15,R2                                                  15570002
             SR R15,R1                                                  15580002
             BCTR R15,0           FOR 1ST  '(' MEMBNAME LEN             15590002
             BCTR R15,0           FOR LAST ')' MEMBNAME LEN             15600002
             IF (LTR,R15,R15,NP),OR,(CH,R15,GT,=H'8')                   15610002
               LA R0,ERRMSG06                                           15620002
               BAL R14,ERRMSG                                           15630002
             ENDIF                                                      15640002
             BCTR R15,0                                                 15650002
             LR R1,R14                                                  15660002
             EX R15,SAVEMEMB                                            15670002
             LA R15,3(R15)                                              15680002
             SR R2,R15                                                  15690002
             LR R1,R3            DSN TOP                                15700002
 ULSNAP 'MEMB   ',(PARMMEMB,8)                                          15710002
           ELSE                                                         15720002
             LR R1,R3            DSN ADDR                               15730002
           ENDIF                                                        15740002
           IF (LTR,R2,R2,NP),OR,(CH,R2,GT,=H'44')                       15750002
             LA R0,ERRMSG06                                             15760002
             BAL R14,ERRMSG                                             15770002
           ENDIF                                                        15780002
           STH R2,PARMDSNL                                              15790002
           BCTR R2,0                                                    15800002
           EX R2,SAVEDSN                                                15810002
           LA R2,1(R2)                                                  15820002
 ULSNAP 'DSN    ',(PARMDSN,(R2))                                        15830002
         ENDIF                                                          15840002
*                                                                       15850002
         L  R14,SVR14GP                                                 15860002
         BR R14                                                         15870002
****************                                                        15880002
SAVEMEMB MVC   PARMMEMB(0),0(R1)                                        15890002
SAVEDSN  MVC   PARMDSN(0),0(R1)                                         15900002
SVR14GP  DS F                                                           15910002
WSPFPA   DS F      SPF PARM ADDR              A#002                     15920002
WSPFPL   DS F      SPF PARM LEN               A#002                     15930002
PARMMEMB DC   CL8' '                                                    15940002
WFUNCID  DC X'00'  FUNCTION ID                A#002                     15950002
EQFSPFUP EQU X'01'  SPF UPDATE                 A#002                    15960002
**********************************************************************  15970002
* ANALYZE SPF INFO PARM                                A#002            15980002
**********************************************************************  15990002
GETSPFPM DS 0H                                                          16000002
         STM R0,R15,SVRGSP                                              16010002
*                                                                       16020002
         MVI CDATESW,0                 CLEAR CDATE PARM EXIST SW A#010  16021022
         L R4,WSPFPA                   SPF PARM TOP                     16030002
         L R5,WSPFPL                   SPF PARM LEN                     16040002
         LA R3,BLDLPENT                PDS2 BASE                        16050002
         SR R6,R6                      PARM NO                          16060002
*GET EACH PARM                                                          16070002
         DO WHILE=(LTR,R5,R5,P)                                         16080002
           LR R2,R4                      EACH PARM TOP                  16090002
           DO WHILE=(LTR,R5,R5,P)                                       16100002
           DOEXIT (CLI,0(R4),E,C',')                                    16110002
             BCTR R5,0                                                  16120002
             LA R4,1(R4)                                                16130002
           ENDDO                                                        16140002
           LR R1,R4                                                     16150002
           SR R1,R2                    PARM LEN                         16160002
 ULSNAP 'PARN N(R6)',((R2),(R1))                                        16170002
           IF (CH,R6,GE,=Y(EQMAXPM))          MAX 8 PARM                16180002
             UERREXIT ERRMSGS1                                          16190002
           ENDIF                                                        16200002
           LR R14,R6                                                    16210002
           SLL R14,2                   *4                               16220002
           ST R2,WSPFPAN(R14)           SAVE ADDR                       16230002
           ST R1,WSPFPLN(R14)           SAVE LEN                        16240002
           LA R6,1(R6)                 PARMNO                           16250002
           LA R4,1(R4)                                                  16260002
           BCTR R5,0                                                    16270002
         ENDDO                                                          16280002
*PROCESS EACH PARM                                                      16290002
         SR R6,R6                                                       16300002
         DO WHILE=(CH,R6,LT,=Y(EQMAXPM))                                16310002
           LR R14,R6                                                    16320002
           SLL R14,2                                                    16330002
           L R2,WSPFPAN(R14)                                            16340002
           L R1,WSPFPLN(R14)                                            16350002
 ULSNAP 'PARN SET N(R6)',((R2),(R1))                                    16360002
           LA R6,1(R6)                 PARMNO                           16370002
           SR R15,R15                  FIELD VALUE IS NEMERIC           16380002
           IF (CLI,0(R2),GE,C'0'),AND,(CLI,0(R2),LE,C'9') //NUMERIC     16390002
           ELSE                                                         16400002
             LA R15,1                  NOT NUMERIC ID                   16410002
           ENDIF                                                        16420002
*VV                                                                     16430002
           IF (CH,R6,E,=Y(1))          VV                               16440002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'DEL')           16450002
               IF (TM,SPFSW,EQUSPFI,NO)    NO SPF INFO                  16460002
                 UERREXIT ERRMSGS2                                      16470002
               ENDIF                                                    16480002
               MVI PDS2INDC,0               CLEAR LENGTH                16490002
               B GETSPFPE                                               16500002
             ENDIF                                                      16510002
             IF (CLI,0(R2),E,C'+')                                      16520002
               SR R15,R15                                               16530002
             ENDIF                                                      16540002
             IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND       16550002
               IF (TM,SPFSW,EQUSPFI,NO)      NO SPF INFO                16560002
                 MVI SPFVV,0             IF OPERAND MISSING SET 0       16570002
               ENDIF                                                    16580002
             ELSE                                                       16590002
               IF (CLI,0(R2),E,C'+')                                    16600002
                 UATOI 1(R2),LEN=(R1)                                   16610002
                 SR R14,R14                                             16620002
                 IC R14,SPFVV                                           16630002
                 AR R1,R14                                              16640002
               ELSE                                                     16650002
                 UATOI 0(R2),LEN=(R1)                                   16660002
               ENDIF                                                    16670002
               IF (CH,R1,GT,=Y(99))                                     16680002
                 UERREXIT ERRMSGS3                                      16690002
               ENDIF                                                    16700002
               STC R1,SPFVV                                             16710002
             ENDIF                                                      16720002
           ELSE                                                         16730002
*MM                                                                     16740002
           IF (CH,R6,E,=Y(2))          MM                               16750002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           16760002
               MVI GETLCRQ,1           GET MAX VALUE ID                 16770002
               BAL R14,GETLINEC        ID OF CURRENT LINE COUNT         16780002
               MVI GETLCRQ,0           GET MAX VALUE ID                 16790002
               STC R1,SPFMM                                             16800002
               SR R1,R1                ID OF TODAY                      16810002
             ELSE                                                       16820002
               IF (CLI,0(R2),E,C'+')                                    16830002
                 SR R15,R15                                             16840002
               ENDIF                                                    16850002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     16860002
                 IF (TM,SPFSW,EQUSPFI,NO)      NO SPF INFO              16870002
                   MVI SPFMM,0             IF OPERAND MISSING SET 0     16880002
                 ENDIF                                                  16890002
               ELSE                                                     16900002
                 IF (CLI,0(R2),E,C'+')                                  16910002
                   UATOI 1(R2),LEN=(R1)                                 16920002
                   SR R14,R14                                           16930002
                   IC R14,SPFMM                                         16940002
                   AR R1,R14                                            16950002
                 ELSE                                                   16960002
                   UATOI 0(R2),LEN=(R1)                                 16970002
                 ENDIF                                                  16980002
                 IF (CH,R1,GT,=Y(99))                                   16990002
                   UERREXIT ERRMSGS3                                    17000002
                 ENDIF                                                  17010002
                 STC R1,SPFMM                                           17020002
               ENDIF                                                    17030002
             ENDIF                      , NOT NOW                       17040002
           ELSE                                                         17050002
*CREATION DATE                                                          17060002
           IF (CH,R6,E,=Y(3))          CDATE                            17070002
            IF (CH,R1,GE,=Y(6)),AND,(CLC,0(3,R2),EQ,=C'000000')         17080002
             XC SPFCRD,SPFCRD                                           17090002
            ELSE                                                        17100002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           17110002
               SR R1,R1                ID OF TODAY                      17120002
             ELSE                                                       17130002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     17140002
                 SR R1,R1                ID OF TODAY                    17150002
*                IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST       17160002
                   BCTR R1,0              KEEP CURRENT VALUE            17170002
*                ENDIF                                                  17180002
               ELSE                                                     17190002
                 LR R1,R2                 DATE FLD ADDR                 17200002
               ENDIF                                                    17210002
             ENDIF                                                      17220002
             IF (LTR,R1,R1,NM)                                          17230002
               BAL R14,DATE2JD                                          17240002
               ST R1,SPFCRD                                             17250002
               MVI CDATESW,1           CDATE PARM SET   SW A#010        17251022
             ENDIF                                                      17260002
            ENDIF                                                       17270002
           ELSE                                                         17280002
*UPDATE DATE                                                            17290002
           IF (CH,R6,E,=Y(4))          UDATE                            17300002
            IF (CH,R1,GE,=Y(6)),AND,(CLC,0(3,R2),EQ,=C'000000')         17310002
             XC SPFCHD,SPFCHD                                           17320002
            ELSE                                                        17330002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           17340002
               SR R1,R1                ID OF TODAY                      17350002
             ELSE                                                       17360002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     17370002
                 SR R1,R1                ID OF TODAY                    17380002
*                IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST       17390002
                   BCTR R1,0              KEEP CURRENT VALUE            17400002
*                ENDIF                                                  17410002
               ELSE                                                     17420002
                 LR R1,R2                 DATE FLD ADDR                 17430002
               ENDIF                                                    17440002
             ENDIF                                                      17450002
             IF (LTR,R1,R1,NM)                                          17460002
               BAL R14,DATE2JD                                          17470002
               ST R1,SPFCHD                                             17480002
               IF (CLI,CDATESW,EQ,0),AND,(OC,SPFCRD,SPFCRD,Z)  A#010    17481022
                 ST R1,SPFCRD        SET SAME AS CHANGE DATE   A#010    17481122
               ENDIF         NO PARM OF CDATE AND NULL         A#010    17482022
             ENDIF                                                      17490002
            ENDIF            , 000000                                   17500002
           ELSE                                                         17510002
*UPDATE TIME                                                            17520002
           IF (CH,R6,E,=Y(5))          UTIME                            17530002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           17540002
               SR R1,R1                ID OF TODAY                      17550002
             ELSE                                                       17560002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     17570002
                 SR R1,R1                ID OF TODAY                    17580002
*                IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST       17590002
                   BCTR R1,0              KEEP CURRENT VALUE            17600002
*                ENDIF                                                  17610002
               ELSE                                                     17620002
                   LR R1,R2                 DATE FLD ADDR               17630002
               ENDIF                                                    17640002
             ENDIF                                                      17650002
             IF (LTR,R1,R1,NM)                                          17660002
               BAL R14,HHMM2TM                                          17670002
*              STH R1,SPFCHT              0000HHMM    D#009             17680021
               STCM R1,B'0110',SPFCHT     00HHMMSS    A#009             17681021
               STC R1,SPFCHTS             SECONDS     A#009             17682021
             ENDIF                                                      17690002
           ELSE                                                         17700002
*CURRENT LINE COUNT                                                     17710002
           IF (CH,R6,E,=Y(6))          CURLINE                          17720002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           17730002
               BAL R14,GETLINEC         ID OF CURRENT LINE COUNT        17740002
               STH R1,SPFCLNO                                           17750002
             ELSE                                                       17760002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     17770002
                 IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST       17780002
                 ELSE                                                   17790002
                   XC SPFCLNO,SPFCLNO                                   17800002
                 ENDIF                                                  17810002
               ELSE                                                     17820002
                 UATOI (R2),LEN=(R1)                                    17830002
                 STH R1,SPFCLNO                                         17840002
               ENDIF                                                    17850002
             ENDIF                                                      17860002
           ELSE                                                         17870002
*INITIAL LINE COUNT                                                     17880002
           IF (CH,R6,E,=Y(7))          INITLINE                         17890002
             IF (CH,R1,GE,=Y(3)),AND,(CLC,0(3,R2),EQ,=C'NOW')           17900002
               BAL R14,GETLINEC         ID OF CURRENT LINE COUNT        17910002
               STH R1,SPFILNO                                           17920002
             ELSE                                                       17930002
               IF (LTR,R1,R1,Z),OR,(LTR,R15,R15,NZ) MISSING OPERAND     17940002
                 SR R1,R1                ID OF KEEP CURRENT             17950002
                 IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST       17960002
                 ELSE                                                   17970002
                   XC SPFILNO,SPFILNO                                   17980002
                 ENDIF                                                  17990002
               ELSE                                                     18000002
                 UATOI (R2),LEN=(R1)                                    18010002
                 STH R1,SPFILNO                                         18020002
               ENDIF                                                    18030002
             ENDIF                                                      18040002
           ELSE                                                         18050002
*USERID                                                                 18060002
           IF (CH,R6,E,=Y(8))          USER                             18070002
             IF (LTR,R1,R1,Z)          MISSING OPERAND                  18080002
               IF (TM,SPFSW,EQUSPFI,O)  PREVIOUS SPF INFO EXIST         18090002
               ELSE                                                     18100002
                 MVC SPFUSR,BLANK                                       18110002
               ENDIF                                                    18120002
             ELSE                                                       18130002
               MVC SPFUSR,BLANK                                         18140002
               IF (CH,R1,GE,=Y(8))                                      18150002
                 LA R1,8                                                18160002
               ENDIF                                                    18170002
               BCTR R1,0                                                18180002
               EX R1,*+4+4                                              18190002
               B *+4+6                                                  18200002
               MVC SPFUSR(0),0(R2)                                      18210002
             ENDIF                                                      18220002
           ELSE                                                         18230002
           ENDIF                       8                                18240002
           ENDIF                       7                                18250002
           ENDIF                       6                                18260002
           ENDIF                       5                                18270002
           ENDIF                       4                                18280002
           ENDIF                       3                                18290002
           ENDIF                       1                                18300002
           ENDIF                       1                                18310002
         ENDDO                                                          18320002
GETSPFPE DS 0H                                                          18330002
         MVC SPFRSV3,BLANK                            A#008             18331020
 ULSNAP 'NEW SPFI',((R3),DIRESZ)                                        18340002
*                                                                       18350002
         LM  R0,R15,SVRGSP                                              18360002
         BR R14                                                         18370002
****************                                                        18380002
SVRGSP   DS 16F                                                         18390002
CDATESW  DS  X                  CREATION DATE SET SW       A#010        18391022
EQMAXPM  EQU 8                                                          18400002
WSPFPAN  DC (EQMAXPM)F'0'                                               18410002
WSPFPLN  DC (EQMAXPM)F'0'                                               18420002
ERRMSGS1 DC CL80' * TOO MANY SPF PARAMETER'                             18430002
ERRMSGS2 DC CL80' * NO SPF INFO TO BE DELETED'                          18440002
ERRMSGS3 DC CL80' * MAX VALUE IS 99 FOR VER/MOD'                        18450002
**********************************************************************  18460002
* GET TIME PARM AND CONV TO SPF FMT                        A#002        18470002
* PARM R1:HHMM   FLD ADDR OR 0 IF CURRENT TIME                          18480002
*   RETURN R1:00HHMMSS                                     A#009        18481021
**********************************************************************  18490002
HHMM2TM  DS 0H                                                          18500002
         ST R14,SVR14GTM                                                18510002
*                                                                       18520002
         IF (LTR,R1,R1,Z)  //CURRENT TIME                               18530002
           TIME              ,           R1:00YYDDDF R0:HHMMSSTH        18540002
           LR R1,R0                                                     18550002
*          SRL R1,16                     0000HHMM         D#009         18560021
           SRL R1,8                      00HHMMSS         A#009         18561021
         ELSE                                                           18570002
           LR R2,R1                                                     18580002
           UATOI (R2),LEN=2                                             18590002
           IF (LTR,R1,R1,M),OR,(CH,R1,GE,=Y(24))                        18600002
*            MVC ERRMSGTM+13(4),0(R2)                     D#011         18610025
             MVC ERRMSGTM+13(6),0(R2)                     A#011         18611025
             UERREXIT ERRMSGTM                                          18620002
           ENDIF                                                        18630002
           UATOI 2(R2),LEN=2                                            18640002
           IF (LTR,R1,R1,M),OR,(CH,R1,GE,=Y(60))                        18650002
*            MVC ERRMSGTM+13(4),0(R2)                     D#011         18660025
             MVC ERRMSGTM+13(6),0(R2)                     A#011         18661025
             UERREXIT ERRMSGTM                                          18670002
           ENDIF                                                        18680002
           UATOI 4(R2),LEN=2                          A#011             18681025
           IF (LTR,R1,R1,M),OR,(CH,R1,GE,=Y(60))      A#011             18682025
             MVC ERRMSGTM+13(6),0(R2)                 A#011             18683025
             UERREXIT ERRMSGTM                        A#011             18684025
           ENDIF                                                        18685025
           MVC WKTMZ(4),0(R2)                                           18690002
           PACK WKTMP(3),WKTMZ(5)         F1F2F3F4XY->1234YX            18700002
           LH R1,WKTMP                                                  18710002
           SLL R1,8                       00HHMM00     A#009            18711025
           MVC WKTMZ(2),4(R2)                          A#011            18712025
           PACK WKTMP(2),WKTMZ(3)         F1F2XY->12YX A#011            18713025
           IC R1,WKTMP                                 A#011            18714025
         ENDIF                                                          18720002
 ULSNAP 'HHMM2TM',((R2),4)                                              18730002
*                                                                       18740002
         L  R14,SVR14GTM                                                18750002
         BR R14                                                         18760002
****************                                                        18770002
SVR14GTM DS F                                                           18780002
WKTMP    DS CL3                                                         18790002
WKTMZ    DS CL5                                                         18800002
*ERRMSGTM DC CL80' * TIME PARM(XXXX) ERR'                        D#011  18810025
ERRMSGTM DC CL80' * TIME PARM(XXXXXX) ERR'                       A#011  18811025
**********************************************************************  18820002
* GET DATE PARM AND CONV TO JURIAN DATE                          A#002  18830002
* PARM R1:YYMMDD FLD ADDR OR 0 IF CURRENT DATE                          18840002
**********************************************************************  18850002
DATE2JD  DS 0H                                                          18860002
         ST R14,SVR14D2J                                                18870002
*                                                                       18880002
         IF (LTR,R1,R1,Z)  //TODAY                                      18890002
           TIME              ,           R1:00YYDDDF R0:HHMMSSTH        18900002
         ELSE                                                           18910002
           MVC WKDTZ(6),0(R1)                                           18920002
           PACK WKDTP(4),WKDTZ(7)         F1F2F3F4F5F6XY->123456YX      18930002
           L R14,WKDTP                                                  18940002
           SRL R14,8                      00YYMMDD                      18950002
           ST R14,WKDTP                                                 18960002
 ULSNAP 'DATE2J UDATE INPUT',WKDTP,((R1),6)                             18970002
           UDATE WKDTP,TODAY=N,INPUT=S    OUTPUT IS ZONE FMT YYMMDD     18980002
 ULSNAP 'DATE2J',WKDTP                                                  18990002
           IF (LTR,R15,R15,NZ)   ERR                                    19000002
             MVC ERRMSGDT+13(6),0(R2)                                   19010002
             UERREXIT ERRMSGDT                                          19020002
           ENDIF                                                        19030002
           PACK WKDTZ(4),WKDTP           00YYDDDC                       19040002
           OI WKDTZ+3,X'0F'              00YYDDDF                       19050002
           IF (CLI,WKDTZ+1,LT,X'80')                                    19060002
             MVI WKDTZ,X'01'              OVER 2000                     19070002
           ENDIF                                                        19080002
           L R1,WKDTZ                                                   19090002
         ENDIF                                                          19100002
 ULSNAP 'DATE2J R1 OUT'                                                 19110002
*                                                                       19120002
         L  R14,SVR14D2J                                                19130002
         BR R14                                                         19140002
****************                                                        19150002
SVR14D2J DS F                                                           19160002
WKDTP    DS CL6        UDATE PARM                                       19170002
         DS 0F                                                          19180002
WKDTZ    DS CL7                                                         19190002
ERRMSGDT DC CL80' * DATE PARM(XXXXXX) ERR'                              19200002
**********************************************************************  19210002
* COUNT LINE BY READING MEMBER                                 A#002    19220002
**********************************************************************  19230002
GETLINEC  DS 0H                                                         19240002
         STM R0,R15,SVRLC                                               19250002
*                                                                       19260002
         L R1,WLINENO                                                   19270002
         IF (LTR,R1,R1,NM)                                              19280002
           IF (CLI,GETLCRQ,E,0) //LINECOUNT REQ                         19290002
             B GETLCE                                                   19300002
           ENDIF                                                        19310002
         ENDIF                                                          19320002
         XC WLINENO,WLINENO                                             19330002
         XC WMAXMM,WMAXMM                                               19340002
         LA R2,PDSDCB3                                                  19350002
*        OPEN ((R2),(INPUT))                                            19360002
*        IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,NO)                        19370002
*          MVC ERRMSGL1+3(8),DCBDDNAM-IHADCB(R2)                        19380002
*          UERREXIT ERRMSGL1                                            19390002
*        ENDIF                                                          19400002
 ULSNAP 'BEFORE FIND',BLDLFIND                                          19410002
         FIND (R2),BLDLFIND,C                                           19420002
         IF (LTR,R15,R15,NZ)                                            19430002
           MVC ERRMSGL2+3(8),BLDLPNAM                                   19440002
           UERREXIT ERRMSGL2                                            19450002
         ENDIF                                                          19460002
         L R4,MEMBBUFF                                                  19470002
         IF (LTR,R4,R4,Z)                                               19480002
           LH R0,DCBBLKSI-IHADCB(R2)                                    19490002
           ST R0,MEMBBUFL                                               19500002
   ULSNAP 'AFTER FIND'                                                  19510002
           GETMAIN RC,LV=(R0)                                           19520002
           IF (LTR,R15,R15,NZ)                                          19530002
             UERREXIT ERRMSGL3                                          19540002
           ENDIF                                                        19550002
           ST R1,MEMBBUFF                                               19560002
           LR R4,R1                    READ BUFF                        19570002
         ENDIF                                                          19580002
         SR R5,R5                    TOTAL LEN                          19590002
         DO INF                      1/2 TIMES               11A#7558   19600002
           READ DECBMEMB,SF,(R2),(R4),'S' READ REC                      19610002
           CHECK DECBMEMB            WAIT I/O COMPLETION                19620002
           L R1,DECBMEMB+16          IOB ADDR                           19630002
           LH R0,DCBBLKSI-IHADCB(R2)                                    19640002
 ULSNAP 'AFTER READ',((R2),64),((R4),(R0))                              19650002
           SH R0,14(R1)              MINUS RESIDUAL LEN=SHORT BLKSZ     19660002
           IF (CLI,GETLCRQ,NE,0)     MOD LEVEL SEARCH REQUEST           19670002
             BAL R14,GETMM                                              19680002
           ENDIF                                                        19690002
           AR R5,R0                  TOTAL LEN                          19700002
         ENDDO                       1/2 TIMES               11A#7558   19710002
EOFMEMB  DS 0H                                                          19720002
         LH R14,DCBLRECL-IHADCB(R2)   LRECL                             19730002
         SR R4,R4                                                       19740002
         DR R4,R14                    RES AND COUNT                     19750002
 ULSNAP 'LINE COUNT R5'                                                 19760002
*        CLOSE ((R2))                                                   19770002
         LR R1,R5                                                       19780002
         ST R1,WLINENO                                                  19790002
GETLCE   DS 0H                                                          19800002
         IF (CLI,GETLCRQ,NE,0) //MAX MM REQ                             19810002
           L R1,WMAXMM                                                  19820002
         ENDIF                                                          19830002
  ULSNAP 'GETLINEC EXIT'                                                19840002
*                                                                       19850002
         LM  R2,R15,SVRLC+R2*4                                          19860002
         BR R14                                                         19870002
****************                                                        19880002
SVRLC    DS 16F                                                         19890002
WLINENO  DC F'-1'                                                       19900002
WMAXMM   DC F'-1'                                                       19910002
MEMBBUFF DC F'0'                                                        19920002
MEMBBUFL DC F'0'                                                        19930002
GETLCRQ  DC X'00' MAX MOD LEVE SEARCH REQ ID                            19940002
ERRMSGL1 DC CL80' * XXXXXXXX OPEN TO GET LINE COUNT FAILED'             19950002
ERRMSGL2 DC CL80' * XXXXXXXX FIND FAILED'                               19960002
ERRMSGL3 DC CL80' * GETMAIN FOR READ MEMBER FAILED'                     19970002
MEMBDATA DS CL80                                                        19980002
**********************************************************************  19990002
* GET MOD LEVEL FROM RECORD                                    A#002    20000002
* INPUT R2 DCB                                                          20010002
* INPUT R4 RECORD BUFF                                                  20020002
* INPUT R0 BUFFSZ                                                       20030002
**********************************************************************  20040002
GETMM    DS 0H                                                          20050002
         STM R14,R4,SVRGMM                                              20060002
         DO WHILE=(LTR,R0,R0,P)                                         20070002
           LA R1,72(R4)                                                 20080002
           DO FROM=(R14,8)                                              20090002
           DOEXIT (CLI,0(R1),LT,C'0'),OR,(CLI,0(R1),GT,C'9')            20100002
             LA R1,R1(R1)                                               20110002
           ENDDO                                                        20120002
           IF (LTR,R14,R14,Z)                                           20130002
             UATOI 78(R4),LEN=2                                         20140002
     ULSNAP 'GET MM ',((R4),80)                                         20150002
             IF (C,R1,H,WMAXMM)                                         20160002
               ST R1,WMAXMM                                             20170002
             ENDIF                                                      20180002
           ENDIF                                                        20190002
           AH R4,=Y(80)                                                 20200002
           SH R0,=Y(80)                                                 20210002
         ENDDO                                                          20220002
         LM  R14,R4,SVRGMM                                              20230002
         BR R14                                                         20240002
****************                                                        20250002
SVRGMM   DS 7F                                                          20260002
**********************************************************************  20270002
* DATASET INFO GET                                                      20280002
**********************************************************************  20290002
DSINFO   DS 0H                                                          20300002
         ST R14,SVR14DSC                                                20310002
*                                                                       20320002
         OPEN  (PDSDCB,(INPUT))                                         20330002
         IF (TM,DCBOFLGS-IHADCB+PDSDCB,DCBOFOPN,NO)                     20340002
           MVC ERRMSG01+3(8),DCBDDNAM-IHADCB+PDSDCB                     20350002
           LA R0,ERRMSG01                                               20360002
           BAL R14,ERRMSG                                               20370002
         ENDIF                                                          20380002
         LH R1,DCBLRECL-IHADCB+PDSDCB                                   20390002
*        IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECF,NO)    RECFM=F  D#006  X 20400018
*              OR,(CH,R1,NE,=Y(80)       NO LIMIT OF 80        D#006    20400118
         IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECF,NO)    RECFM=F  A#006    20400218
            MVI SPFSW,0                                                 20420002
         ELSE                                                           20430002
            MVI SPFSW,EQUSPFF   SPF FILE                                20440002
         ENDIF                                                          20450002
*DS INFO                                                                20460002
         LH R1,DCBLRECL-IHADCB+PDSDCB                                   20470002
         UI2Z (R1),HLRECL,LEN=5                                         20480002
         LH R1,DCBBLKSI-IHADCB+PDSDCB                                   20490002
         UI2Z (R1),HBLKSZ,LEN=5                                         20500002
         IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECU,O)                       20510002
           MVI HRECFM,C'U'                                              20520002
         ELSE                                                           20530002
           IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECF,O)                     20540002
             MVI HRECFM,C'F'                                            20550002
           ELSE                                                         20560002
             IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECV,O)                   20570002
               MVI HRECFM,C'V'                                          20580002
             ENDIF                                                      20590002
           ENDIF                                                        20600002
           IF (TM,DCBRECFM-IHADCB+PDSDCB,DCBRECBR,O)                    20610002
             MVI HRECFM+1,C'B'                                          20620002
           ENDIF                                                        20630002
         ENDIF                                                          20640002
         IF (TM,DCBDSORG-IHADCB+PDSDCB,DCBDSGPS,O)                      20650002
           MVC HDSORG,=C'PS'                                            20660002
         ELSE                                                           20670002
           IF (TM,DCBDSORG-IHADCB+PDSDCB,DCBDSGPO,O)                    20680002
             MVC HDSORG,=C'PO'                                          20690002
           ELSE                                                         20700002
             IF (TM,DCBDSORG-IHADCB+PDSDCB,DCBDSGDA,O)                  20710002
               MVC HDSORG,=C'DA'                                        20720002
             ELSE                                                       20730002
               IF (TM,DCBDSORG-IHADCB+PDSDCB,DCBDSGIS,O)                20740002
                 MVC HDSORG,=C'IS'                                      20750002
               ENDIF                                                    20760002
             ENDIF                                                      20770002
           ENDIF                                                        20780002
         ENDIF                                                          20790002
*                                                                       20800002
         CLOSE (PDSDCB)                                                 20810002
*                                                                       20820002
         L R14,SVR14DSC                                                 20830002
         BR R14                                                         20840002
****************                                                        20850002
SVR14DSC DS F                                                           20860002
HDR4     DC CL80' '                                                     20870002
         ORG HDR4                                                       20880002
         DC C'-DSORG='                                                  20890002
HDSORG   DS CL2                                                         20900002
         DC C' RECFM='                                                  20910002
HRECFM   DS CL2                                                         20920002
         DC C' LRECL='                                                  20930002
HLRECL   DS CL5                                                         20940002
         DC C' BLKSIZE='                                                20950002
HBLKSZ   DS CL5                                                         20960002
         ORG                                                            20970002
**********************************************************************  20980002
* GET DIR INFO BY BLDL                                          A#001   20990002
*   PARM: R2 DCB                                                        21000002
*********************************************************************** 21010002
BLDLMEMB DS 0H                                                          21020002
         ST R14,SVR14BLD                                                21030002
*                                                                       21040002
         MVC  BLDLPNAM,PARMMEMB                                         21050002
         BLDL (R2),BLDLPARM                                             21060002
         IF (LTR,R15,R15,NZ)                                            21070002
           MVC ERRMSGNF+21(8),PARMMEMB                                  21080002
           LA R0,ERRMSGNF                                               21090002
           BAL R14,ERRMSG                                               21100002
         ENDIF                                                          21110002
 ULSNAP 'AFTER BLDL',BLDLPENT                                           21120002
         MVC BLDLFIND,BLDLPTTR         SAVE FOR FIND API                21130002
         MVC BLDLPK(SPFISZ+1),BLDLPC   DROP K,Z FLD FOR DIR ENT FORMAT  21140002
 ULSNAP 'AFTER BLDL2',BLDLPENT                                          21150002
*                                                                       21160002
         L R14,SVR14BLD                                                 21170002
         BR R14                                                         21180002
****************                                                        21190002
SVR14BLD DS F                                                           21200002
ERRMSGNF DC CL80' * MEMBER NOT FOUND (XXXXXXXX)'                        21210002
BLDLPARM DS 0F                                                          21220002
         DC H'1'         COUNT                                          21230002
         DC H'62'        ENTRY LEN                                      21240002
BLDLPENT DC XL62'00'                                                    21250002
         ORG BLDLPENT                                                   21260002
BLDLPNAM DS CL8                                                         21270002
BLDLPTTR DS CL3                                                         21280002
BLDLPK   DS CL1          CONCATINATION                                  21290002
BLDLPZ   DS CL1                                                         21300002
BLDLPC   DS CL1                                                         21310002
BLDLPUSR DS 0C                                                          21320002
*                                                                       21330002
         ORG                                                            21340002
BLDLFIND DS CL4          TTRC                                           21350002
**********************************************************************  21360002
* PARM D/S ALLOCATION                                                   21370002
*********************************************************************** 21380002
DSALLOC  DS 0H                                                          21390002
         ST R14,SVR14DAI                                                21400002
*                                                                       21410002
         IF (CLI,WFUNCID,E,EQFSPFUP)                              A#002 21420002
           MVI #S99DISP,EQDOLD                   DISP=OLD       A#002   21430002
         ENDIF                                                  A#002   21440002
         MVI DCBID,C'1'                                                 21450002
         LA R1,#S99RBX1             POINT 20BYTES BYND RBPTR TOP        21460002
         BAL R14,DYNALLOC                                               21470002
         MVI SWDSALOK,1                                         A#004   21471062
*                                                                       21480002
         L R14,SVR14DAI                                                 21490002
         BR R14                                                         21500002
****************                                                        21510002
SVR14DAI DS F                                                           21520002
SWDSALOK DC X'00'                                               A#004   21521062
#S99RBX1 DS   0F                       DSECT HAS NO LENGTH EQU          21530002
         DC   A(#S99TDSN)                                               21540002
         DC   A(#S99TDDN)                                               21550002
         DC   A(#S99TDSP+X'80000000')                                   21560002
#S99TDSN DS   0F                                                        21570002
         DC   AL2(DALDSNAM),AL2(1)                                      21580002
PARMDSNL DC   AL2(8)                                                    21590002
PARMDSN  DC   CL44' '                                                   21600002
#S99TDSP DS   0F                                                        21610002
         DC   AL2(DALSTATS),AL2(1)                                      21620002
         DC   AL2(1)                                                    21630002
#S99DISP DC   AL1(8)                   DISP=SHR                         21640002
EQDOLD   EQU  X'01'                     DISP=OLD                        21650002
#S99TDDN DS   0F                                                        21660002
         DC   AL2(DALRTDDN),AL2(1)                                      21670002
         DC   AL2(8)                                                    21680002
RETDDN   DC   CL8' '                                                    21690002
**********************************************************************  21700002
* SYSOUT   ALLOCATION                                                   21710002
*********************************************************************** 21720002
SOALLOC  DS 0H                                                          21730002
         ST R14,SVR14DAO                                                21740002
*                                                                       21750002
         IF (CLI,TSOJOBID,NE,0)       UNDER TSO                         21760002
           LA R1,#S99RBX3             POINT 20BYTES BYND RBPTR TOP      21770002
         ELSE                                                           21780002
           LA R1,#S99RBX2             POINT 20BYTES BYND RBPTR TOP      21790002
         ENDIF                                                          21800002
         MVI DCBID,C'2'                                                 21810002
         BAL R14,DYNALLOC                                               21820002
*                                                                       21830002
         L R14,SVR14DAO                                                 21840002
         BR R14                                                         21850002
****************                                                        21860002
SVR14DAO DS F                                                           21870002
#S99RBX2 DS   0F                       SYSOUT ALL                       21880002
         DC   A(#S99TSOT)                                               21890002
         DC   A(#S99TDDN+X'80000000')                                   21900002
#S99RBX3 DS   0F                       TERMINAL ALLOCATION              21910002
         DC   A(#S99TTRM)                                               21920002
         DC   A(#S99TDDN+X'80000000')                                   21930002
#S99TSOT DS   0F                                                        21940002
         DC   AL2(DALSYSOU),AL2(0)     COUNT=0:DEFAULT CLASS            21950002
*        DC   AL2(1)                                                    21960002
*        DC   C'A'                     SYSOUT=A                         21970002
#S99TTRM DS   0F                                                        21980002
         DC   AL2(DALTERM),AL2(0)     TSO TERMINAL                      21990002
**********************************************************************  22000002
CLOSEFRE DS 0H                                                          22010002
         ST R14,SVR14CF                                                 22020002
         L R2,MEMBBUFF                                                  22030002
         L R0,MEMBBUFL                                                  22040002
         IF (LTR,R2,R2,NZ)                                              22050002
           FREEMAIN RU,A=(R2),LV=(R0)                                   22060002
         ENDIF                                                          22070002
         LA R2,PDSDCB2                                                  22080002
         IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,O)                         22090002
           CLOSE ((R2))                                                 22100002
         ENDIF                                                          22110002
         LA R2,PDSDCB3                                                  22120002
         IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,O)                         22130002
           CLOSE ((R2))                                                 22140002
         ENDIF                                                          22150002
         IF (CLI,DCBDDNAM-IHADCB(R2),NE,C' ')  //ALLOCATED              22160002
           MVC UNALDDNM,DCBDDNAM-IHADCB(R2)                             22170002
           MVI DCBDDNAM-IHADCB(R2),C' '                                 22180002
           MVI DCBID,C'1'                                               22190002
           LA R1,#S99RBX4             POINT 20BYTES BYND RBPTR TOP      22200002
           BAL R14,DYNAFREE                                             22210002
         ENDIF                                                          22220002
         LA R2,OUTDCB                                                   22230002
         IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,O)                         22240002
           CLOSE ((R2))                                                 22250002
         ENDIF                                                          22260002
* TSO:UNALLOC FAIL, BATCH:SYSOUT GONE ANYWHERE                          22270002
*        IF (CLI,TSOJOBID,E,0)  UNDER TSO                               22280002
*            IF (CLI,DCBDDNAM-IHADCB(R2),NE,C' ')  //ALLOCATED          22290002
*              MVC UNALDDNM,DCBDDNAM-IHADCB(R2)                         22300002
*              MVI DCBDDNAM-IHADCB(R2),C' '                             22310002
*              MVI DCBID,C'2'                                           22320002
*              LA R1,#S99RBX4             POINT 20BYTES BYND RBPTR TOP  22330002
*              BAL R14,DYNAFREE                                         22340002
*            ENDIF                                                      22350002
*        ENDIF                                                          22360002
         L R14,SVR14CF                                                  22370002
         BR R14                                                         22380002
*******************************                                         22390002
SVR14CF  DS F                                                           22400002
#S99RBX4 DS   0F                       SYSOUT ALL                       22410002
         DC   A(#S99TUDD+X'80000000')                                   22420002
#S99TUDD DS   0F                                                        22430002
         DC   AL2(DUNDDNAM),AL2(1)     UNALLOCATION DDNAME              22440002
         DC   AL2(8)                                                    22450002
UNALDDNM DC   CL8' '                   DDNAME                           22460002
**********************************************************************  22470002
* DYNALOC SUB                                                           22480002
* PARM R1:TEXT UNIT LIST                                                22490002
*********************************************************************** 22500002
DYNALLOC DS 0H                                                          22510002
         ST R14,SVR14DA                                                 22520002
         LA    R4,#S99RB                                                22530002
         XC    S99RB(#S99RBSZ),S99RB   ZERO CLEAR RB ENTIRELY           22540002
         MVI   S99RBLN,#S99RBSZ        SET RB LNGTH IN ITS LNGTH FLD    22550002
         MVI   S99VERB,S99VRBAL        SET VERB CODE                    22560002
         MVI   S99FLG11,S99NOMNT       NO MOUNT                         22570002
         ST    R1,S99TXTPP             SET TXT PNTRS INTO RB            22580002
*                                                                       22590002
         LA    R1,#S99RBPT             ADDR OF PARAMETER AREA           22600002
         DYNALLOC                                                       22610002
         IF (LTR,R15,R15,NZ)                    DYNALLOC ERR            22620002
           BAL R14,DYNAERR                                              22630002
         ENDIF                                                          22640002
*                                                                       22650002
         L R14,SVR14DA                                                  22660002
         BR R14                                                         22670002
*******************************                                         22680002
SVR14DA  DS F                                                           22690002
#S99RBPT DC   A(#S99RB+X'80000000')                                     22700002
#S99RB   DS   CL256 (#S99RBSZ)                                          22710002
**********************************************************************  22720002
* DYNALOC SUB                                                           22730002
* PARM R1:TEXT UNIT LIST                                                22740002
*********************************************************************** 22750002
DYNAFREE DS 0H                                                          22760002
         ST R14,SVR14DF                                                 22770002
         IF (CLI,SWDSALOK,E,0)                             A#004        22770262
            BR R14                                         A#004        22770362
         ENDIF                                             A#004        22771059
         LA    R4,#S99RB                                                22780002
         XC    S99RB(#S99RBSZ),S99RB   ZERO CLEAR RB ENTIRELY           22790002
         MVI   S99RBLN,#S99RBSZ        SET RB LNGTH IN ITS LNGTH FLD    22800002
         MVI   S99VERB,S99VRBUN        SET VERB CODE/UNALLOCATION       22810002
         ST    R1,S99TXTPP             SET TXT PNTRS INTO RB            22820002
*                                                                       22830002
         LA    R1,#S99RBPT             ADDR OF PARAMETER AREA           22840002
         DYNALLOC                                                       22850002
         IF (LTR,R15,R15,NZ)                    DYNALLOC ERR            22860002
           BAL R14,DYNAERR                                              22870002
         ENDIF                                                          22880002
*                                                                       22890002
         L R14,SVR14DF                                                  22900002
         BR R14                                                         22910002
*******************************                                         22920002
SVR14DF  DS F                                                           22930002
**********************************************************************  22940002
* DYNALOC ERRMSG                                                        22950002
* PARM R1:TEXT UNIT LIST                                                22960002
*********************************************************************** 22970002
DYNAERR  DS 0H                                                          22980002
         ST R14,SVR14DE                                                 22990002
         UI2X (R15),ERRMSG05+15,LEN=2                                   23000002
         L R0,S99RSC                                                    23010002
         UI2X (R0),ERRMSG05+18                                          23020002
         IF (CLI,S99VERB,EQ,S99VRBAL)        ALLOC                      23030002
           MVC ERRMSG05+3(8),=C'DYNALLOC'                               23040002
           IF (CLC,S99TXTPP,E,=A(#S99RBX1))     DS ALLOC                23050002
             MVC ERRMSG05+27(44),PARMDSN                                23060002
           ELSE                                                         23070002
             MVC ERRMSG05+27(44),BLANK                                  23080002
             MVC ERRMSG05+27(6),=C'SYSOUT'                              23090002
           ENDIF                                                        23100002
           IF (CLC,S99ERROR,EQ,=X'1708')                                23110002
             MVC ERRMSG05+3(8),=C'NOT-CAT '                             23120002
           ENDIF                                                        23130002
           IF (CLC,S99ERROR,EQ,=X'020C'),                              X23140002
               OR,(CLC,S99ERROR,EQ,=X'0210')                            23150002
             MVC ERRMSG05+3(8),=C'IN-USE  '                             23160002
           ENDIF                                                        23170002
         ELSE                                                           23180002
           MVC ERRMSG05+3(8),=C'DYNAFREE'                               23190002
           IF (CLI,DCBID,E,C'1')                                        23200002
             MVC ERRMSG05+27(44),PARMDSN                                23210002
           ELSE                                                         23220002
             MVC ERRMSG05+27(44),BLANK                                  23230002
             MVC ERRMSG05+27(6),=C'SYSOUT'                              23240002
           ENDIF                                                        23250002
         ENDIF                                                          23260002
         LA R0,ERRMSG05                                                 23270002
         BAL R14,ERRMSG                                                 23280002
*                                                                       23290002
         L R14,SVR14DE                                                  23300002
         BR R14                                                         23310002
*******************************                                         23320002
SVR14DE  DS F                                                           23330002
ERRMSG05 DC    CL80' * XXXXXXXX RC=XX:XXXXXXXX X'                       23340002
**********************************************************************  23350002
DISPHDR  DS 0H                                                          23360002
         ST R14,SVR14DH                                                 23370002
*                                                                       23380002
         LA R0,HDR1                                                     23390002
         BAL R14,PUTOUT                                                 23400002
         LA R0,HDR4                                                     23410002
         BAL R14,PUTOUT                                                 23420002
         LA R0,HDR2                                                     23430002
         BAL R14,PUTOUT                                                 23440002
*                                                                       23450002
         L R14,SVR14DH                                                  23460002
         BR R14                                                         23470002
SVR14DH  DS F                                                           23480002
**********************************************************************  23490002
DISPMEMB DS 0H                                                          23500002
         ST R14,SVR14                                                   23510002
         IF (TM,PDS2INDC,PDS2ALIS,O)                                    23520002
            OI SPFSW,EQUALIAS  SPF INFO EXIST                           23530002
         ELSE                                                           23540002
            NI SPFSW,X'FF'-EQUALIAS  SPF INFO EXIST                     23550002
         ENDIF                                                          23560002
         IF (CLI,PDS2INDC,EQ,PDS2SPFI) SPF INFO DATA LEN=X0F(30 BYTE)   23570002
            OI SPFSW,EQUSPFI   SPF INFO EXIST                           23580002
         ELSE                                                           23590002
            NI SPFSW,X'FF'-EQUSPFI   SPF INFO EXIST                     23600002
            IF (CLI,PDS2INDC,NE,0)   OTHER DIR INFOO                    23610002
              OI SPFSW,EQUOTHER  SPF INFO EXIST                         23620002
            ELSE                                                        23630002
              NI SPFSW,X'FF'-EQUOTHER  SPF INFO EXIST                   23640002
            ENDIF                                                       23650002
         ENDIF                                                          23660002
         MVI WKSPFINF,C' '                                              23670002
         MVC WKSPFINF+1(L'WKSPFINF-1),WKSPFINF                          23680002
*MEMBER NAME                                                            23690002
         IF (CLI,DISPUPDT,E,0)                                          23700002
           MVC WKSPFNAM,PDS2NAME                                        23710002
         ELSE                                                           23720002
           MVC WKSPFNAM,=C'=======>'                                    23730002
         ENDIF                                                          23740002
         MVI WKSPFVV,EQUVERNO          NO SPF DATA                      23750002
         IF (TM,SPFSW,EQUALIAS,O)                                       23760002
           MVC WKSPFVV(5),=C'ALIAS '      ALIAS                         23770002
           L R14,ALIASNO                                                23780002
           LA R14,1(R14)                                                23790002
           ST R14,ALIASNO                                               23800002
         ENDIF                                                          23810002
       IF (TM,SPFSW,EQUSPFF+EQUSPFI,O) RECFM=F,LRECL=80,UDATALEN=0F     23820002
*VVMM                                                                   23830002
         SR R2,R2                                                       23840002
         IC R2,SPFVV                                                    23850002
         UI2Z (R2),WKSPFVV,LEN=2                                        23860002
         MVI WKSPFVV+2,C'.'                                             23870002
         SR R2,R2                                                       23880002
         IC R2,SPFMM                                                    23890002
         UI2Z (R2),WKSPFMM,LEN=2                                        23900002
*CRE DATE                                                               23910002
       IF (OC,SPFCRD,SPFCRD,NZ)                                         23920002
         MVC WKDATE(4),SPFCRD                                           23930002
         UDATE WKDATE,TODAY=N,INPUT=J,TBL=N  R0=00YYMMDD                23940002
         IF (LTR,R15,R15,Z)                                             23950002
           MVC WKSPFCRD(2),WKDATE                                       23960002
           MVI WKSPFCRD+2,C'/'                                          23970002
           MVC WKSPFCRD+3(2),WKDATE+2                                   23980002
           MVI WKSPFCRD+5,C'/'                                          23990002
           MVC WKSPFCRD+6(2),WKDATE+4                                   24000002
         ELSE                                                           24010002
           MVC WKSPFCRD(8),=C'??/??/??'                                 24020002
         ENDIF                                                          24030002
       ELSE                                                             24040002
         MVC WKSPFCRD(8),=C'00/00/00'                                   24050002
       ENDIF                                                            24060002
*CHG DATE                                                               24070002
       IF (OC,SPFCHD,SPFCHD,NZ)                                         24080002
         MVC WKDATE(4),SPFCHD                                           24090002
         UDATE WKDATE,TODAY=N,INPUT=J,TBL=N  R0=00YYMMDD                24100002
         IF (LTR,R15,R15,Z)                                             24110002
           MVC WKSPFCHD(2),WKDATE                                       24120002
           MVI WKSPFCHD+2,C'/'                                          24130002
           MVC WKSPFCHD+3(2),WKDATE+2                                   24140002
           MVI WKSPFCHD+5,C'/'                                          24150002
           MVC WKSPFCHD+6(2),WKDATE+4                                   24160002
         ELSE                                                           24170002
           MVC WKSPFCHD(8),=C'??/??/??'                                 24180002
         ENDIF                                                          24190002
       ELSE                                                             24200002
         MVC WKSPFCHD(8),=C'00/00/00'                                   24210002
       ENDIF                                                            24220002
*CHG TIME                                                               24230002
         LH R2,SPFCHT                                                   24240002
         UI2X (R2)                                                      24250002
         MVC WKSPFCHT(2),4(R1)                                          24260002
         MVI WKSPFCHT+2,C':'                                            24270002
         MVC WKSPFCHT+3(2),6(R1)                                        24280002
         SR R2,R2                                       A#011           24280124
         IC R2,SPFCHTS           UPDATE TIME SECONDS    A#011           24281024
         UI2X (R2)                                      A#011           24282024
         MVI WKSPFCHT+5,C':'                            A#011           24284024
         MVC WKSPFCHT+6(2),6(R1)                        A#011           24285024
*CUR SIZE                                                               24290002
         LH R2,SPFCLNO                                                  24300002
         UI2ZE (R2),WKSPFCSZ,LEN=11                                     24310002
*INI SIZE                                                               24320002
         LH R2,SPFILNO                                                  24330002
         UI2ZE (R2),WKSPFISZ,LEN=11                                     24340002
*UPD SIZE                                                               24350002
*        LH R2,DIRUSZ                                                   24360002
*        UI2ZE (R2),WKSPFUSZ,LEN=7                                      24370002
*USERID                                                                 24380002
         MVC WKSPFUID,SPFUSR                                            24390002
         IF (CLC,SPFUSR,E,BLANK)                                        24400002
           MVI WKSPFUID,C'-'       SEE IT                               24410002
         ENDIF                                                          24420002
       ENDIF                                                            24430002
*                                                                       24440002
         LA R0,WKSPFINF                                                 24450002
         BAL R14,PUTOUT                                                 24460002
         IF (CLI,DISPUPDT,E,0)                                          24470002
           L R14,LINENO                                                 24480002
           LA R14,1(R14)                                                24490002
           ST R14,LINENO                                                24500002
         ENDIF                                                          24510002
*                                                                       24520002
EXITDM   DS 0H                                                          24530002
         L R14,SVR14                                                    24540002
         BR R14                                                         24550002
*********                                                               24560002
SVR14    DS F                                                           24570002
DISPUPDT DC X'00'         UPDATED LINE DISPLAY REQ ID                   24580002
LINENO   DC F'0'                                                        24590002
ALIASNO  DC F'0'                                                        24600002
HDR1     DC CL80'MEMBER LIST FOR '                                      24610002
HDR2     DC CL80' '                                                     24620002
         ORG HDR2                                                       24630002
         DC CL8'-NAME---'                                               24640002
*        DS CL2                                  D#007                  24650019
         DS CL3                                  A#007                  24651019
         DC CL5'VV.MM'                                                  24660002
         DS CL2                                                         24670002
         DC CL8'CREATED'  CREATION DATE     YY/MM/DD                    24680002
         DS CL2                                                         24690002
         DC CL14'LAST-UPDATED'                                          24700002
         DS CL3                             :SS         A#011           24701024
         DS CL2                                                         24710002
         DC CL11' LINE-COUNT'                                           24720002
         DS CL1                                                         24730002
         DC CL11'    INITIAL'                                           24740002
         DS CL2                                                         24750002
         DC CL8'USERID'                                                 24760002
*        DS CL4                                       D#007             24770019
*        DS CL3                                       A#007  D#011      24771024
         ORG                                                            24780002
*********************************************************************** 24790002
* GET EXE PGM NAME                                                      24800002
*********************************************************************** 24810002
GETTJID  DS 0H                                                          24820002
         ST R14,SVR14TS                                                 24830002
         L R14,16                                                       24840002
         L R14,0(R14)                                                   24850002
         L R14,4(R14)      CURR TCB                                     24860002
         L R14,TCBJSCB-TCB(R14)  JSCB                                   24870002
         L R0,JSCBPSCB-IEZJSCB(R14)   TSO PROTECTED STEP CONTROL        24880002
         IF (LTR,R0,R0,NZ)                                              24890002
           MVI TSOJOBID,1                                               24900002
         ENDIF                                                          24910002
         L R14,SVR14TS                                                  24920002
         BR R14                                                         24930002
SVR14TS  DS F                                                           24940002
**********************************************************************  24950002
* ERRMSG PRINT                                                          24960002
*   PARM R0:MSG TEXT                                                    24970002
*********************************************************************** 24980002
ERRMSG   DS 0H                                                          24990002
         BAL R14,PUTOUT                                                 25000002
         LA R15,8                                                       25010002
         B EXIT                                                         25020002
**********************************************************************  25030002
* ERRMSG PRINT                                                          25040002
*   PARM R0:MSG TEXT                                                    25050002
*********************************************************************** 25060002
PUTOUT   DS 0H                                                          25070002
         ST R14,SVR14PO                                                 25080002
         ST R0,SVR0PO                                                   25090002
         IF (TM,DCBOFLGS-IHADCB+OUTDCB,DCBOFOPN,O) OPEND                25100002
           PUT OUTDCB,(R0)                                              25110002
         ENDIF                                                          25120002
         IF (TM,DCBOFLGS-IHADCB+OUTDCB,DCBOFOPN,NO),                   X25130002
               OR,(CLI,WTOREQ,NE,0)                                     25140002
           L R14,SVR0PO                                                 25150002
           MVC WTOMSG01+4(80),0(R14)                                    25160002
           WTO MF=(E,WTOMSG01)                                          25170002
         ENDIF                                                          25180002
         L R14,SVR14PO                                                  25190002
         BR R14                                                         25200002
SVR14PO  DS F                                                           25210002
SVR0PO   DS F                                                           25220002
WTOREQ   DC X'00'                                                       25230002
**********************************************************************  25240002
* ESTAE SETUP                                                           25250002
*   RET R0:PARM,R1:PARM,R2:MACNAME                                      25260002
*********************************************************************** 25270002
PXMSESTS DS 0H                                                          25280002
         ST R14,SVR14E                                                  25290002
         L R2,=A(PXMSESTX)                                              25300002
         LA R3,ESTPRM                                                   25310002
*                                                                       25320002
         ESTAE (R2),CT,PARAM=(R3),         * ESTAE RTN. E.P            +25330002
               XCTL=NO,PURGE=NONE,ASYNCH=YES,TERM=YES                   25340002
         L R14,SVR14E                                                   25350002
         BR R14                                                         25360002
ESTPRM   DC F'0'                                                        25370002
SVR14E   DS F                                                           25380002
**********************************************************************  25390002
*ESTAE EXIT                                                             25400002
*********************************************************************** 25410002
PXMSESTX DS 0D                                                          25420002
         DROP R9,R10,R11,R12                                            25430002
         USING PXMSESTX,R15                                             25440002
         STM R0,R15,##ESTREG                                            25450002
*                                                                       25460002
         LM R9,R12,##ESTBS2                                             25470002
         DROP R15                                                       25480002
         USING XE4S001Z,R12,R11,R10,R9                                  25490002
*                                                                       25500002
         USING SDWA,R5                                                  25510002
*                                                                       25520002
         LR R8,R0                PROC ID                                25530002
         LR R5,R1                SAWA /COMPCODE                         25540002
         LA R13,##ESTXSA                                                25550002
*                                                                       25560002
         MVI WTOREQ,1             ALSO WTO                              25570002
         IF (C,R8,NE,=F'12')       SDWA NOT OBTAINED                    25580002
           L R7,SDWAPARM         8BYTE COPY OF MODIFTABLE AREA          25590002
           L R4,SDWAABCC                                                25600002
         ELSE                                                           25610002
           LR R7,R2               PARM JOB ENTRY                        25620002
           LR R4,R5               COMPCD                                25630002
         ENDIF                                                          25640002
*                                                                       25650002
         IF (C,R8,NE,=F'12')       SDWA NOT OBTAINED                    25660002
           L R2,=A(WKMSG45)                                             25670002
         ELSE                                                           25680002
           L R2,=A(WKMSG46)                                             25690002
         ENDIF                                                          25700002
         UI2X (R4),39(R2)                                               25710002
         LR R0,R2                                                       25720002
         BAL R14,PUTOUT                                                 25730002
*PSW,OFFS                                                               25740002
         IF (C,R8,NE,=F'12')       SDWA NOT OBTAINED                    25750002
           L R2,SDWAEC1                                                 25760002
           UI2X (R2),WKMSG47+8                                          25770002
           L R2,SDWAEC1+4                                               25780002
           UI2X (R2),WKMSG47+17                                         25790002
           LA R1,0(R2)                                                  25800002
           LA R0,0(R12)                                                 25810002
           SR R1,R0                                                     25820002
           UI2X (R1),WKMSG47+31                                         25830002
           LA R0,WKMSG47                                                25840002
           BAL R14,PUTOUT                                               25850002
*REG                                                                    25860002
           DO FROM=(R2,4)                                               25870002
             LA R14,4                                                   25880002
             SR R14,R2                                                  25890002
             SLL R14,2                                                  25900002
             UI2Z (R14),WKMSG48+4,LEN=2                                 25910002
             LA R15,3(R14)                                              25920002
             UI2Z (R15),WKMSG48+8,LEN=2                                 25930002
             SLL R14,2                                                  25940002
             LA R14,SDWAGR00(R14)    STRAT REG                          25950002
             L R15,0(R14)                                               25960002
             UI2X  (R15),WKMSG48++12                                    25970002
             L R15,4(R14)                                               25980002
             UI2X  (R15),WKMSG48++21                                    25990002
             L R15,8(R14)                                               26000002
             UI2X  (R15),WKMSG48++30                                    26010002
             L R15,12(R14)                                              26020002
             UI2X (R15),WKMSG48++39                                     26030002
             LA R0,WKMSG48                                              26040002
             BAL R14,PUTOUT                                             26050002
           ENDDO                                                        26060002
         ENDIF                                                          26070002
 ULSNAP 'ESTAE'                                                         26080002
         LA R2,OUTDCB                                                   26090002
         IF (TM,DCBOFLGS-IHADCB(R2),DCBOFOPN,O)                         26100002
           CLOSE ((R2))                                                 26110002
         ENDIF                                                          26120002
*                                                                       26130002
         IF (C,R8,NE,=F'12')      SDWA NOT OBTAINED                     26140002
           LR R1,R5                                                     26150002
           SETRP RC=0                                                   26160002
         ENDIF                                                          26170002
         SR R15,R15                                                     26180002
         LM R0,R14,##ESTREG                                             26190002
         BR R14                                                         26200002
*********************************************************************** 26210002
##ESTBS2 DC A(XE4S001Z+4096+4096+4096)  R9                              26220002
         DC A(XE4S001Z+4096+4096)       R10                             26230002
         DC A(XE4S001Z+4096)            R11                             26240002
         DC A(XE4S001Z)                 R12                             26250002
##ESTREG DS 16F                                                         26260002
##ESTXSA DS 18F                                                         26270002
WKMSG45  DC CL80' * XE4S001Z:ENTERED ESTAE WITH SDWA,CC=12345678'       26280002
WKMSG46  DC CL80' * XE4S001Z:ENTERED ESTAE W/O  SDWA,CC=12345678'       26290002
WKMSG47  DC CL80' * PSW= 12345678 12345678 OFFS=12345678'               26300002
WKMSG48  DC CL80' * RXX-RXX: 12345678 12345678 12345678 12345678'       26310002
************************************************************            26320002
***      AREA DEFINE                                     ***            26330002
************************************************************            26340002
MVCHDR1  MVC   HDR1+16(0),0(R1)                                   R#002 26350002
         LTORG                                                          26360002
SAVEA    DS    18F                     * REGISTER SAVE AREA             26370002
BLANK    DC    CL256' '                                                 26380002
WTOMSG01 WTO   '.........1.........2.........3.........4.........5.....X26390002
               ...6.........7.........8',MF=L                           26400002
ERRMSG01 DC    CL80' * XXXXXXXX PDS OPEN FAILED.'                       26410002
ERRMSG02 DC    CL80' * XXXXXXXX DIRECTORY OPEN FAILED.'                 26420002
ERRMSG03 DC    CL80' * DSNAME PARAMETER MISSING'                        26430002
ERRMSG04 DC    CL80'XXXXXXXX (PRINT OUT DCB) OPEN FAILED'               26440002
ERRMSG06 DC    CL80' * PARAMETER FORMAT ERR(DSN OR MEMBERNAME LENGTH)'  26450002
*RRMSG08 DC    CL80' * PARM ERR:MISSING MEMBER NAME'                    26460002
ERRMSG09 DC    CL80' * OPERATION ALLOWED ONLY FOR DATASET WITH RECFM=F(+26470002
               B) LRECL=80'                                             26480002
SPFSW    DC    X'00'                                                    26490002
EQUSPFF  EQU   X'01'                                                    26500002
EQUSPFI  EQU   X'02'                                                    26510002
EQUALIAS EQU   X'04'                                                    26520002
EQUOTHER EQU   X'08'                                                    26530002
DCBID    DC C'0'                                                        26540002
TSOJOBID DC X'0'                                                        26550002
*                                                                       26560002
PDSDCB   DCB   DSORG=PO,MACRF=(R),DDNAME=XE4S001I EXLST=EXL             26570002
PDSDCB2  DCB   DSORG=PS,MACRF=R,DDNAME=XE4S001I,RECFM=U,BLKSIZE=256,   +26580002
               EODAD=EOFDIR                                             26590002
PDSDCB3  DCB   DSORG=PO,DEVD=DA,DDNAME=XE4S001I,MACRF=(R,W),           +26600002
               EODAD=EOFMEMB                                            26610002
OUTDCB   DCB   DSORG=PS,MACRF=(PM),DDNAME=XE4S001O,RECFM=F,            X26620002
               LRECL=80,BLKSIZE=80                                      26630002
WKDATE   DS CL6                                                         26640002
DIRAREA  DS CL256                                                       26650002
                                                                        26660002
WKSPFINF DC CL80' '                                                     26670002
         ORG WKSPFINF                                                   26680002
         DS CL1           KEEP SPACE FOR THE CASE MEMBERNAME=READY      26690002
WKSPFNAM DS CL8           MEMBER NAME                                   26700002
         DS CL2                                                         26710002
WKSPFVV  DS CL2           VERSION                                       26720002
EQUVERNO EQU C'-'         NO SPF INFO ID ON VERSION FLD                 26730002
         DC CL1'.'                                                      26740002
WKSPFMM  DS CL2           MODIFIER                                      26750002
         DS CL2                                                         26760002
WKSPFCRD DC CL8'YY/MM/DD' CREATION DATE     YY/MM/DD                    26770002
         DS CL2                                                         26780002
WKSPFCHD DC CL8'YY/MM/DD' LAST CHANGED DATE YY/MM/DD                    26790002
         DS CL1                                                         26800002
*KSPFCHT DC CL5'HH:MM'    LAST CHANGED TIME HH:MM              D#011    26810024
WKSPFCHT DC CL8'HH:MM:SS' LAST CHANGED TIME HH:MM              A#011    26811024
         DS CL2                                                         26820002
WKSPFCSZ DS CL11          CURRENT LINE SIZE NNN,NNN,NNN                 26830002
         DS CL1                                                         26840002
WKSPFISZ DS CL11          INIT    LINE SIZE NNN,NNN,NNN                 26850002
         DS CL2                                                         26860002
WKSPFUID DS CL8           USERID                                        26870002
*        DS CL3                                               D#011     26880024
         ORG                                                            26890002
*                                                                       26900002
********************************************************************    26910002
PDS2     DSECT                                                          26920002
PDS2NAME DS CL8                                                         26930002
PDS2TTRP DS CL3                                                         26940002
PDS2INDC DS CL1                                                         26950002
PDS2ALIS EQU X'80'    ALIAS                                             26960002
PDS2LUSR EQU X'1F'    MASK OF USER DATA LENGTH BY HALF WORD             26970002
PDS2SPFI EQU X'0F'    SPF DATA LEN                                      26980002
PDS2USRD DS 0C                                                          26990002
SPFVV    DS CL1                                                         27000002
SPFMM    DS CL1                                                         27010002
*SPFRSV1  DS CL2                               D#009                    27020021
SPFRSV1  DS CL1                                A#009                    27021021
SPFCHTS  DS CL1     CHG TIME:SECONDS           A#009                    27022021
SPFCRD   DS CL4     CRE DATE                                            27030002
SPFCHD   DS CL4     CHG DATE                                            27040002
SPFCHT   DS CL2     CHD TIME                                            27050002
SPFCLNO  DS CL2     CUR LINE COUNT                                      27060002
SPFILNO  DS CL2     INIT LINE COUNT                                     27070002
SPFRSV2  DS CL2                                                         27080002
SPFUSR   DS CL8     USER ID                                             27090002
SPFRSV3  DS CL2                                                         27100002
SPFISZ   EQU *-PDS2USRD                                                 27110002
DIRESZ   EQU *-PDS2                                                     27120002
********                                                                27130002
*                                                                       27140002
         PRINT NOGEN                                                    27150002
         DCBD  DSORG=PS                                                 27160002
         IHASDWA                                                        27170002
         IKJTCB                                                         27180002
         IEFZB4D0         , DYNALOC RB                                  27190002
         IEFZB4D2         , DYNALOC KEY                                 27200002
#S99RBSZ EQU S99RBEND-S99RB                                             27210002
         IEZJSCB                                                        27220002
         END                                                            27230002
